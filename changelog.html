<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Changelog - Moltis Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Documentation for Moltis - Your AI coding assistant">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/admonish.css">
        <link rel="stylesheet" href="theme/custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Moltis Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/moltis-org/moltis" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/moltis-org/moltis/edit/main/docs/src/src/changelog.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<p>All notable changes to this project will be documented in this file.</p>
<p>The format is based on <a href="https://keepachangelog.com/en/1.1.0/">Keep a Changelog</a>,
and this project adheres to <a href="https://semver.org/spec/v2.0.0.html">Semantic Versioning</a>.</p>
<h2 id="unreleased"><a class="header" href="#unreleased">[Unreleased]</a></h2>
<h3 id="added"><a class="header" href="#added">Added</a></h3>
<ul>
<li>Event-driven heartbeat wake system: cron jobs can now trigger immediate
heartbeat runs via a <code>wakeMode</code> field (<code>"now"</code> or <code>"nextHeartbeat"</code>).</li>
<li>System events queue: in-memory bounded buffer that collects events (exec
completions, cron triggers) and drains them into the heartbeat prompt so the
agent sees what happened while it was idle.</li>
<li>Exec completion callback: command executions automatically enqueue a summary
event and wake the heartbeat, giving the agent real-time awareness of
background task results.</li>
</ul>
<h3 id="changed"><a class="header" href="#changed">Changed</a></h3>
<h3 id="deprecated"><a class="header" href="#deprecated">Deprecated</a></h3>
<h3 id="removed"><a class="header" href="#removed">Removed</a></h3>
<h3 id="fixed"><a class="header" href="#fixed">Fixed</a></h3>
<h3 id="security"><a class="header" href="#security">Security</a></h3>
<h2 id="091---2026-02-19"><a class="header" href="#091---2026-02-19">[0.9.1] - 2026-02-19</a></h2>
<h3 id="added-1"><a class="header" href="#added-1">Added</a></h3>
<ul>
<li><code>lightweight</code> feature profile for memory-constrained devices (Raspberry Pi, etc.)
with only essential features: <code>jemalloc</code>, <code>tls</code>, <code>web-ui</code>.</li>
<li>jemalloc allocator behind <code>jemalloc</code> feature flag for lower memory fragmentation.</li>
<li>Configurable <code>history_points</code> (metrics) and <code>log_buffer_size</code> (server) settings
to tune in-memory buffer sizes.</li>
<li>Persistent browser profiles: cookies, auth state, and local storage now persist
across sessions by default. Disable with <code>persist_profile = false</code> in
<code>[tools.browser]</code>, or set a custom path with <code>profile_dir</code>. (#162)</li>
<li>Added <code>examples/docker-compose.coolify.yml</code> plus Docker/cloud deploy docs for
self-hosted Coolify (e.g. Hetzner), including reverse-proxy defaults and
Docker socket mount guidance for sandboxed exec support.</li>
<li>Markdown and ANSI table rendering in chat messages.</li>
<li>Provider-aware <code>show_map</code> links for multi-provider map display.</li>
<li>Session history caching with visual switch loader for faster session
transitions.</li>
</ul>
<h3 id="changed-1"><a class="header" href="#changed-1">Changed</a></h3>
<ul>
<li>MetricsHistory default reduced from 60,480 to 360 points (~170x less memory).</li>
<li>LogBuffer default reduced from 10,000 to 1,000 entries.</li>
<li>Shared <code>reqwest::Client</code> singleton in <code>moltis-agents</code> and <code>moltis-tools</code> replaces
per-call client creation, saving connection pools and TLS session caches.</li>
<li>WebSocket client channels changed from unbounded to bounded (512), adding
backpressure for slow consumers.</li>
<li>Release profile: <code>panic = "abort"</code> and <code>codegen-units = 1</code> for smaller binaries.</li>
</ul>
<h3 id="deprecated-1"><a class="header" href="#deprecated-1">Deprecated</a></h3>
<h3 id="removed-1"><a class="header" href="#removed-1">Removed</a></h3>
<h3 id="fixed-1"><a class="header" href="#fixed-1">Fixed</a></h3>
<ul>
<li>Onboarding identity save now captures browser timezone and persists it to
<code>USER.md</code> via <code>user_timezone</code>, so first-run profile setup records the user’s
timezone alongside their name.</li>
<li>Runtime prompt host metadata now prefers user/browser timezone over server
local fallback and includes an explicit <code>today=YYYY-MM-DD</code> field so models
can reliably reason about the user’s current date.</li>
<li>Skills installation now supports Claude marketplace repos that define skills
directly via <code>.claude-plugin/marketplace.json</code> <code>plugins[].skills[]</code> paths
(for example <code>anthropics/skills</code>), including loading <code>SKILL.md</code> entries under
<code>skills/*</code> and exposing them through the existing plugin-skill workflow.</li>
<li>Web search no longer falls back to DuckDuckGo by default when search API keys
are missing, avoiding repeated CAPTCHA failures; fallback is now opt-in via
<code>tools.web.search.duckduckgo_fallback = true</code>.</li>
<li>Terminal: force tmux window resize on client viewport change to prevent
stale dimensions after reconnect.</li>
<li>Browser: profile persistence now works correctly on Apple Container
(macOS containerized sandbox).</li>
<li>Browser: centralized stale CDP connection detection prevents ghost browser
sessions from accumulating. (#172)</li>
<li>Gateway: deduplicate voice replies on Telegram channels to prevent echo
loops. (#173)</li>
<li>Cron job editor: fix modal default validation and form reset when switching
schedule type. (#181)</li>
<li>MCP: strip internal metadata from tool call arguments before forwarding to
MCP servers.</li>
<li>Web search: load runtime env keys and improve Brave search response
parsing robustness.</li>
<li>Prompt: clarify sandbox vs <code>data_dir</code> path semantics in system prompts.</li>
<li>Gateway: align <code>show_map</code> listing ratings to the right for consistent
layout.</li>
</ul>
<h3 id="security-1"><a class="header" href="#security-1">Security</a></h3>
<h2 id="090---2026-02-17"><a class="header" href="#090---2026-02-17">[0.9.0] - 2026-02-17</a></h2>
<h3 id="added-2"><a class="header" href="#added-2">Added</a></h3>
<ul>
<li>Settings &gt; Cron job editor now supports per-job LLM model selection and
execution target selection (<code>host</code> or <code>sandbox</code>), including optional
sandbox image override when sandbox execution is selected.</li>
</ul>
<h3 id="changed-2"><a class="header" href="#changed-2">Changed</a></h3>
<ul>
<li>Configuration documentation examples now match the current schema
(<code>[server]</code>, <code>[identity]</code>, <code>[tools]</code>, <code>[hooks.hooks]</code>,
<code>[mcp.servers.&lt;name&gt;]</code>, and <code>[channels.telegram.&lt;account&gt;]</code>), including
updated provider and local-LLM snippets.</li>
</ul>
<h3 id="deprecated-2"><a class="header" href="#deprecated-2">Deprecated</a></h3>
<h3 id="removed-2"><a class="header" href="#removed-2">Removed</a></h3>
<h3 id="fixed-2"><a class="header" href="#fixed-2">Fixed</a></h3>
<ul>
<li>Agent loop iteration limit is now configurable via
<code>tools.agent_max_iterations</code> in <code>moltis.toml</code> (default <code>25</code>) instead of
being hardcoded at runtime.</li>
</ul>
<h3 id="security-2"><a class="header" href="#security-2">Security</a></h3>
<h2 id="0838---2026-02-17"><a class="header" href="#0838---2026-02-17">[0.8.38] - 2026-02-17</a></h2>
<h3 id="added-3"><a class="header" href="#added-3">Added</a></h3>
<ul>
<li><code>show_map</code> now supports multi-point maps via <code>points[]</code>, rendering all
destinations in one screenshot with auto-fit zoom/centering, while keeping
legacy single-point fields for backward compatibility.</li>
<li>Telegram channel reply streaming via edit-in-place updates, with per-account
<code>stream_mode</code> gating so <code>off</code> keeps the classic final-message delivery path.</li>
<li>Telegram per-account <code>stream_notify_on_complete</code> option to send a final
non-silent completion message after edit-in-place streaming finishes.</li>
<li>Telegram per-account <code>stream_min_initial_chars</code> option (default <code>30</code>) to
delay the first streamed message until enough text has accumulated.</li>
</ul>
<h3 id="changed-3"><a class="header" href="#changed-3">Changed</a></h3>
<h3 id="deprecated-3"><a class="header" href="#deprecated-3">Deprecated</a></h3>
<h3 id="removed-3"><a class="header" href="#removed-3">Removed</a></h3>
<h3 id="fixed-3"><a class="header" href="#fixed-3">Fixed</a></h3>
<h3 id="security-3"><a class="header" href="#security-3">Security</a></h3>
<h2 id="0837---2026-02-17"><a class="header" href="#0837---2026-02-17">[0.8.37] - 2026-02-17</a></h2>
<h3 id="added-4"><a class="header" href="#added-4">Added</a></h3>
<ul>
<li>Settings &gt; Terminal now includes tmux window tabs for the managed
<code>moltis-host-terminal</code> session, plus a <code>+ Tab</code> action to create new tmux
windows from the UI.</li>
<li>New terminal window APIs: <code>GET /api/terminal/windows</code> and
<code>POST /api/terminal/windows</code> to list and create host tmux windows.</li>
<li>Host terminal websocket now supports <code>?window=&lt;id|index&gt;</code> targeting and
returns <code>activeWindowId</code> in the ready payload.</li>
</ul>
<h3 id="changed-4"><a class="header" href="#changed-4">Changed</a></h3>
<ul>
<li>Web chat now supports <code>/sh</code> command mode: entering <code>/sh</code> toggles a dedicated
command input state, command sends are automatically prefixed with <code>/sh</code>,
and the token bar shows effective execution route (<code>sandboxed</code> vs <code>host</code>)
plus prompt symbol (<code>#</code> for root, <code>$</code> for non-root).</li>
<li>Settings &gt; Terminal now polls tmux windows and updates tabs automatically,
so windows created inside tmux (for example <code>Ctrl-b c</code>) appear in the web UI.</li>
<li>Host terminal tmux integration now uses a dedicated tmux socket and applies
a Moltis-friendly profile (status off, mouse off, stable window naming).</li>
<li>Settings &gt; Terminal subtitle now omits the prompt symbol hint so it does not
show stale <code>$</code>/<code>#</code> information after privilege changes inside the shell.</li>
</ul>
<h3 id="deprecated-4"><a class="header" href="#deprecated-4">Deprecated</a></h3>
<h3 id="removed-4"><a class="header" href="#removed-4">Removed</a></h3>
<h3 id="fixed-4"><a class="header" href="#fixed-4">Fixed</a></h3>
<ul>
<li>Apple Container sandbox startup now pins <code>--workdir /tmp</code>, bootstraps
<code>/home/sandbox</code> before <code>sleep infinity</code>, and uses explicit exec workdirs to
avoid <code>WORKDIR</code> chdir failures when image metadata directories are missing.</li>
<li>Cron tool job creation/update now accepts common shorthand schedule/payload
shapes (including cron expression strings) and normalizes them before
validation, reducing model-side schema mismatch failures.</li>
<li>Force-exec fallback now triggers only for explicit <code>/sh ...</code> input (including
<code>/sh@bot ...</code>), preventing casual chat messages like <code>hey</code> from being treated
as shell commands while still allowing normal model-driven exec tool use.</li>
<li>Tool-mode system prompt guidance is now conversation-first and documents the
<code>/sh</code> explicit shell prefix.</li>
<li>Chat auto-compaction now uses estimated next-request prompt tokens (current
context pressure) instead of cumulative session token totals, and chat context
UI now separates cumulative usage from current/estimated request context.</li>
<li>Settings &gt; Terminal tab switching now uses in-band tmux window switching over
the active websocket, reducing redraw/cursor corruption when switching
between tmux windows (including fullscreen apps like <code>vim</code>).</li>
<li>Host terminal tmux attach now resets window sizing to auto (<code>resize-window -A</code>)
to prevent stale oversized window dimensions across reconnects.</li>
<li>Settings &gt; Terminal tmux window polling now continues after tab switches, so
windows closed with <code>Ctrl-D</code> are removed from the tab strip automatically.</li>
<li>Settings &gt; Terminal now recovers from stale <code>?window=</code> reconnect targets
after a tmux window is closed, attaching to the current window instead of
getting stuck in a reconnect loop.</li>
<li>Settings &gt; Terminal host PTY output is now transported as raw bytes
(base64-encoded over websocket) instead of UTF-8-decoded text, fixing
rendering/control-sequence corruption in full-screen terminal apps like <code>vim</code>.</li>
<li>Settings &gt; Terminal now force-syncs terminal size on connect/window switch so
newly created tmux windows attach at full viewport size instead of a smaller
default geometry.</li>
<li>Settings &gt; Terminal now ignores OSC color/palette mutation sequences from
full-screen apps to avoid invisible-text redraw glitches when switching tmux
tabs (notably seen with <code>vim</code>).</li>
<li>Settings &gt; Terminal now re-sends forced resize updates during a short
post-connect settle window, fixing initial page-reload cases where tmux
windows stayed at stale dimensions until a manual tab switch.</li>
</ul>
<h3 id="security-4"><a class="header" href="#security-4">Security</a></h3>
<h2 id="0836---2026-02-16"><a class="header" href="#0836---2026-02-16">[0.8.36] - 2026-02-16</a></h2>
<h3 id="added-5"><a class="header" href="#added-5">Added</a></h3>
<ul>
<li>OAuth 2.1 support for remote MCP servers — automatic discovery (RFC 9728/8414), dynamic client registration (RFC 7591), PKCE authorization code flow, and Bearer token injection with 401 retry</li>
<li><code>McpOAuthOverride</code> config option for servers that don’t implement standard OAuth discovery</li>
<li><code>mcp.reauth</code> RPC method to manually trigger re-authentication for a server</li>
<li>Persistent storage of dynamic client registrations at <code>~/.config/moltis/mcp_oauth_registrations.json</code></li>
<li><strong>SSRF allowlist</strong>: <code>tools.web.fetch.ssrf_allowlist</code> config field to exempt trusted
CIDR ranges from SSRF blocking, enabling Docker inter-container networking.</li>
<li>Memory config: add <code>memory.disable_rag</code> to force keyword-only memory search while keeping markdown indexing and memory tools enabled</li>
<li>Generic OpenAI-compatible provider support: connect any OpenAI-compatible endpoint via the provider setup UI, with domain-derived naming (<code>custom-</code> prefix), model auto-discovery, and full model selection</li>
</ul>
<h3 id="changed-5"><a class="header" href="#changed-5">Changed</a></h3>
<h3 id="deprecated-5"><a class="header" href="#deprecated-5">Deprecated</a></h3>
<h3 id="removed-5"><a class="header" href="#removed-5">Removed</a></h3>
<h3 id="fixed-5"><a class="header" href="#fixed-5">Fixed</a></h3>
<ul>
<li><strong>Telegram queued replies</strong>: route channel reply targets per queued message so
<code>chat.message_queue_mode = "followup"</code> delivers replies one-by-one instead of
collapsing queued channel replies into a single batch delivery.</li>
<li><strong>Queue mode default</strong>: make one-by-one replay (<code>followup</code>) explicit as the
<code>ChatConfig</code> default, with config-level tests to prevent regressions.</li>
<li>MCP OAuth dynamic registration now uses the exact loopback callback URI selected for the current auth flow, improving compatibility with providers that require strict redirect URI matching (for example Linear).</li>
<li>MCP manager now applies <code>[mcp.servers.&lt;name&gt;.oauth]</code> override settings when building the OAuth provider for SSE servers.</li>
<li>Streamable HTTP MCP transport now persists and reuses <code>Mcp-Session-Id</code>, parses <code>text/event-stream</code> responses, and sends best-effort <code>DELETE</code> on shutdown to close server sessions.</li>
<li>MCP docs/config examples now use the current table-based config shape and <code>/mcp</code> endpoint examples for remote servers.</li>
<li>Memory embeddings endpoint composition now avoids duplicated path segments like <code>/v1/v1/embeddings</code> and accepts base URLs ending in host-only, <code>/v1</code>, versioned paths (for example <code>/v4</code>), or <code>/embeddings</code></li>
</ul>
<h3 id="security-5"><a class="header" href="#security-5">Security</a></h3>
<h2 id="0835---2026-02-15"><a class="header" href="#0835---2026-02-15">[0.8.35] - 2026-02-15</a></h2>
<h3 id="added-6"><a class="header" href="#added-6">Added</a></h3>
<ul>
<li>Add memory target routing guidance to <code>memory_save</code> prompt hint — core facts go to MEMORY.md, everything else to <code>memory/&lt;topic&gt;.md</code> to keep context lean</li>
</ul>
<h3 id="changed-6"><a class="header" href="#changed-6">Changed</a></h3>
<h3 id="deprecated-6"><a class="header" href="#deprecated-6">Deprecated</a></h3>
<h3 id="removed-6"><a class="header" href="#removed-6">Removed</a></h3>
<h3 id="fixed-6"><a class="header" href="#fixed-6">Fixed</a></h3>
<h3 id="security-6"><a class="header" href="#security-6">Security</a></h3>
<h2 id="0834---2026-02-15"><a class="header" href="#0834---2026-02-15">[0.8.34] - 2026-02-15</a></h2>
<h3 id="added-7"><a class="header" href="#added-7">Added</a></h3>
<ul>
<li>Add explicit <code>memory_save</code> hint in system prompt so weaker models (MiniMax, etc.) call the tool when asked to remember something</li>
<li>Add anchor text after memory content so models don’t ignore known facts when <code>memory_search</code> returns empty</li>
<li>Add <code>zai</code> to default offered providers in config template</li>
</ul>
<h3 id="changed-7"><a class="header" href="#changed-7">Changed</a></h3>
<h3 id="deprecated-7"><a class="header" href="#deprecated-7">Deprecated</a></h3>
<h3 id="removed-7"><a class="header" href="#removed-7">Removed</a></h3>
<h3 id="fixed-7"><a class="header" href="#fixed-7">Fixed</a></h3>
<h3 id="security-7"><a class="header" href="#security-7">Security</a></h3>
<h2 id="0833---2026-02-15"><a class="header" href="#0833---2026-02-15">[0.8.33] - 2026-02-15</a></h2>
<h3 id="added-8"><a class="header" href="#added-8">Added</a></h3>
<h3 id="changed-8"><a class="header" href="#changed-8">Changed</a></h3>
<h3 id="deprecated-8"><a class="header" href="#deprecated-8">Deprecated</a></h3>
<h3 id="removed-8"><a class="header" href="#removed-8">Removed</a></h3>
<h3 id="fixed-8"><a class="header" href="#fixed-8">Fixed</a></h3>
<ul>
<li><strong>CI</strong>: remove unnecessary <code>std::path::</code> qualification in gateway server flagged
by nightly clippy.</li>
</ul>
<h3 id="security-8"><a class="header" href="#security-8">Security</a></h3>
<h2 id="0832---2026-02-15"><a class="header" href="#0832---2026-02-15">[0.8.32] - 2026-02-15</a></h2>
<h3 id="added-9"><a class="header" href="#added-9">Added</a></h3>
<h3 id="changed-9"><a class="header" href="#changed-9">Changed</a></h3>
<h3 id="deprecated-9"><a class="header" href="#deprecated-9">Deprecated</a></h3>
<h3 id="removed-9"><a class="header" href="#removed-9">Removed</a></h3>
<h3 id="fixed-9"><a class="header" href="#fixed-9">Fixed</a></h3>
<ul>
<li><strong>CI</strong>: gate macOS-only sandbox helper functions with <code>#[cfg]</code> to fix dead-code
errors on Linux CI.</li>
</ul>
<h3 id="security-9"><a class="header" href="#security-9">Security</a></h3>
<h2 id="0831---2026-02-15"><a class="header" href="#0831---2026-02-15">[0.8.31] - 2026-02-15</a></h2>
<h3 id="added-10"><a class="header" href="#added-10">Added</a></h3>
<ul>
<li>
<p><strong>Sandbox toggle notification</strong>: when the sandbox is enabled or disabled
mid-session, a system message is injected into the conversation history so
the LLM knows the execution environment changed. A chat notice also appears
in the UI immediately.</p>
</li>
<li>
<p><strong>Config <code>[env]</code> section</strong>: environment variables defined in <code>[env]</code> in
<code>moltis.toml</code> are injected into the Moltis process at startup. This makes
API keys (Brave, OpenRouter, etc.) available to features that read from
<code>std::env::var()</code>. Process env vars (<code>docker -e</code>, host env) take precedence.
Closes #107.</p>
</li>
<li>
<p><strong>Browser auto-detection and install</strong>: automatically detect all installed
Chromium-family browsers (Chrome, Chromium, Edge, Brave, Opera, Vivaldi, Arc)
and auto-install via the system package manager when none is found. Requests
can specify a preferred browser (<code>"browser": "brave"</code>) or let the system
pick the first available one.</p>
</li>
<li>
<p><strong>Z.AI provider</strong>: add Z.AI (Zhipu) as an OpenAI-compatible provider with
static model catalog (GLM-5, GLM-4.7, GLM-4.6, GLM-4.5 series) and dynamic
model discovery via <code>/models</code> endpoint. Supports tool calling, streaming,
vision (GLM-4.6V/4.5V), and reasoning content.</p>
</li>
<li>
<p><strong>Running Containers panel</strong>: the Settings &gt; Sandboxes page now shows a
“Running Containers” section listing all moltis-managed containers with
live state (running/stopped/exited), backend type (Apple Container/Docker),
resource info, and Stop/Delete actions. Includes disk usage display
(container/image counts, sizes, reclaimable space) and a “Clean All”
button to stop and remove all stale containers at once.</p>
</li>
<li>
<p><strong>Startup container GC</strong>: the gateway now automatically removes orphaned
session containers on startup, preventing disk space accumulation from
crashed or interrupted sessions.</p>
</li>
<li>
<p><strong>Download full context as JSONL</strong>: the full context panel now has a
“Download” button that exports the conversation (including raw LLM
responses) as a timestamped <code>.jsonl</code> file.</p>
</li>
<li>
<p><strong>Sandbox images in cached images list</strong>: the Settings &gt; Images page
now merges sandbox-built images into the cached images list so all
container images are visible in one place.</p>
</li>
</ul>
<h3 id="changed-10"><a class="header" href="#changed-10">Changed</a></h3>
<ul>
<li><strong>Sandbox image identity</strong>: image tags now use SHA-256 instead of
<code>DefaultHasher</code> for deterministic, cross-run hashing of base image +
packages.</li>
</ul>
<h3 id="deprecated-10"><a class="header" href="#deprecated-10">Deprecated</a></h3>
<h3 id="removed-10"><a class="header" href="#removed-10">Removed</a></h3>
<h3 id="fixed-10"><a class="header" href="#fixed-10">Fixed</a></h3>
<ul>
<li><strong>Thinking indicator lost on reload</strong>: reloading the page while the model
was generating no longer loses the “thinking” dots. The backend now includes
<code>replying</code> state in <code>sessions.list</code> and <code>sessions.switch</code> RPC responses so
the frontend can restore the indicator after a full page reload.</li>
<li><strong>Thinking text restored after reload</strong>: reloading the page during extended
thinking (reasoning) now restores the accumulated thinking text instead of
showing only bouncing dots. The backend tracks thinking text per session and
returns it in the <code>sessions.switch</code> response.</li>
<li><strong>Apple Container recovery</strong>: simplify container recovery to a single flat
retry loop (3 attempts max, down from up to 24). Name rotation now only
triggers on <code>AlreadyExists</code> errors, preventing orphan containers. Added
<code>notFound</code> error matching so exec readiness probes retry correctly.
Diagnostic info (running container count, service health, container logs)
is now included in failure messages. Detect stale Virtualization.framework
state (<code>NSPOSIXErrorDomain EINVAL</code>) and automatically restart the daemon
(<code>container system stop &amp;&amp; container system start</code>) before retrying; bail
with a clear remediation message only if automatic restart fails.
Exec-level recovery retries reduced from 3 to 1.</li>
<li><strong>Ghost Apple Containers</strong>: failed container deletions are now tracked
in a zombie set and filtered from list output, preventing stale entries
from reappearing in the Running Containers panel.</li>
<li><strong>Container action errors preserved</strong>: failed delete/clean/restart
operations now surface the original error message to the UI instead of
silently swallowing it.</li>
<li><strong>Usage parsing across OpenAI-compatible providers</strong>: token counts now
handle Anthropic-style (<code>input_tokens</code>/<code>output_tokens</code>), camelCase
variants, cache token fields, and multiple response nesting structures
across diverse providers.</li>
<li><strong>Think tag whitespace</strong>: leading whitespace after <code>&lt;/think&gt;</code> close
tags is now stripped, preventing extra blank lines in streamed output.</li>
<li><strong>Token bar visible at zero</strong>: the token usage bar no longer disappears
when all counts are zero; it stays visible as a baseline indicator.</li>
</ul>
<h3 id="security-10"><a class="header" href="#security-10">Security</a></h3>
<h2 id="0830---2026-02-15"><a class="header" href="#0830---2026-02-15">[0.8.30] - 2026-02-15</a></h2>
<h3 id="added-11"><a class="header" href="#added-11">Added</a></h3>
<h3 id="changed-11"><a class="header" href="#changed-11">Changed</a></h3>
<ul>
<li><strong>Assistant reasoning persistence</strong>: conversation reasoning is now persisted
in assistant messages and shared snapshots so resumed sessions retain
reasoning context instead of dropping it after refresh/share operations.</li>
</ul>
<h3 id="deprecated-11"><a class="header" href="#deprecated-11">Deprecated</a></h3>
<h3 id="removed-11"><a class="header" href="#removed-11">Removed</a></h3>
<h3 id="fixed-11"><a class="header" href="#fixed-11">Fixed</a></h3>
<h3 id="security-11"><a class="header" href="#security-11">Security</a></h3>
<h2 id="0829---2026-02-14"><a class="header" href="#0829---2026-02-14">[0.8.29] - 2026-02-14</a></h2>
<h3 id="added-12"><a class="header" href="#added-12">Added</a></h3>
<ul>
<li><strong>Memory bootstrap</strong>: inject <code>MEMORY.md</code> content directly into the system
prompt (truncated at 20,000 chars) so the agent always has core memory
available without needing to call <code>memory_search</code> first. Matches OpenClaw’s
bootstrap behavior</li>
<li><strong>Memory save tool</strong>: new <code>memory_save</code> tool lets the LLM write to long-term
memory files (<code>MEMORY.md</code> or <code>memory/&lt;name&gt;.md</code>) with append/overwrite modes
and immediate re-indexing for search</li>
</ul>
<h3 id="changed-12"><a class="header" href="#changed-12">Changed</a></h3>
<ul>
<li><strong>Memory writing</strong>: <code>MemoryManager</code> now implements the <code>MemoryWriter</code> trait
directly, unifying read and write paths behind a single manager. The silent
memory turn and <code>MemorySaveTool</code> both delegate to the manager, which handles
path validation, size limits, and automatic re-indexing after writes</li>
</ul>
<h3 id="deprecated-12"><a class="header" href="#deprecated-12">Deprecated</a></h3>
<h3 id="removed-12"><a class="header" href="#removed-12">Removed</a></h3>
<h3 id="fixed-12"><a class="header" href="#fixed-12">Fixed</a></h3>
<ul>
<li><strong>Memory file watcher</strong>: the file watcher now covers <code>MEMORY.md</code> at the data
directory root, which was previously excluded because the filter only matched
directories</li>
</ul>
<h3 id="security-12"><a class="header" href="#security-12">Security</a></h3>
<h2 id="0828---2026-02-14"><a class="header" href="#0828---2026-02-14">[0.8.28] - 2026-02-14</a></h2>
<h3 id="added-13"><a class="header" href="#added-13">Added</a></h3>
<h3 id="changed-13"><a class="header" href="#changed-13">Changed</a></h3>
<ul>
<li><strong>Browser sandbox resolution</strong>: <code>BrowserTool</code> now resolves sandbox mode
directly from <code>SandboxRouter</code> instead of relying on a <code>_sandbox</code> flag
injected via tool call params.</li>
</ul>
<h3 id="deprecated-13"><a class="header" href="#deprecated-13">Deprecated</a></h3>
<h3 id="removed-13"><a class="header" href="#removed-13">Removed</a></h3>
<h3 id="fixed-13"><a class="header" href="#fixed-13">Fixed</a></h3>
<ul>
<li><strong>E2E onboarding failures</strong>: Fixed missing <code>saveProviderKey</code> export in
<code>provider-validation.js</code> that was accidentally left unstaged in the DRY
refactoring commit.</li>
</ul>
<h3 id="security-13"><a class="header" href="#security-13">Security</a></h3>
<h2 id="0827---2026-02-14"><a class="header" href="#0827---2026-02-14">[0.8.27] - 2026-02-14</a></h2>
<h3 id="added-14"><a class="header" href="#added-14">Added</a></h3>
<h3 id="changed-14"><a class="header" href="#changed-14">Changed</a></h3>
<ul>
<li><strong>DRY voice/identity/channel utils</strong>: Extracted shared RPC wrappers and
validation helpers from <code>onboarding-view.js</code> and <code>page-settings.js</code> /
<code>page-channels.js</code> into dedicated <code>voice-utils.js</code>, <code>identity-utils.js</code>,
and <code>channel-utils.js</code> modules.</li>
</ul>
<h3 id="deprecated-14"><a class="header" href="#deprecated-14">Deprecated</a></h3>
<h3 id="removed-14"><a class="header" href="#removed-14">Removed</a></h3>
<h3 id="fixed-14"><a class="header" href="#fixed-14">Fixed</a></h3>
<ul>
<li><strong>Config test env isolation</strong>: Fixed spurious
<code>save_config_to_path_removes_stale_keys_when_values_are_cleared</code> test
failure caused by <code>MOLTIS_IDENTITY__NAME</code> environment variable leaking
into the test via <code>apply_env_overrides</code>.</li>
</ul>
<h3 id="security-14"><a class="header" href="#security-14">Security</a></h3>
<h2 id="0826---2026-02-14"><a class="header" href="#0826---2026-02-14">[0.8.26] - 2026-02-14</a></h2>
<h3 id="added-15"><a class="header" href="#added-15">Added</a></h3>
<ul>
<li><strong>Rustls/OpenSSL migration roadmap</strong>: Added
<code>plans/2026-02-14-rustls-migration-and-openssl-reduction.md</code> with a staged
plan to reduce OpenSSL coupling, isolate feature gates, and move default TLS
networking paths toward rustls.</li>
</ul>
<h3 id="changed-15"><a class="header" href="#changed-15">Changed</a></h3>
<h3 id="deprecated-15"><a class="header" href="#deprecated-15">Deprecated</a></h3>
<h3 id="removed-15"><a class="header" href="#removed-15">Removed</a></h3>
<h3 id="fixed-15"><a class="header" href="#fixed-15">Fixed</a></h3>
<ul>
<li><strong>Windows release build reliability</strong>: The <code>.exe</code> release workflow now forces
Strawberry Perl (<code>OPENSSL_SRC_PERL</code>/<code>PERL</code>) so vendored OpenSSL builds do not
fail due to missing Git Bash Perl modules.</li>
<li><strong>OpenAI tool-call ID length</strong>: Remap tool-call IDs that exceed OpenAI’s
40-character limit during message serialization, and generate shorter
synthetic IDs in the agent runner to prevent API errors.</li>
<li><strong>Onboarding credential persistence</strong>: Provider credentials are now saved
before opening model selection during onboarding, aligning behavior with the
Settings &gt; LLM flow.</li>
</ul>
<h3 id="security-15"><a class="header" href="#security-15">Security</a></h3>
<h2 id="0825---2026-02-14"><a class="header" href="#0825---2026-02-14">[0.8.25] - 2026-02-14</a></h2>
<h3 id="added-16"><a class="header" href="#added-16">Added</a></h3>
<h3 id="changed-16"><a class="header" href="#changed-16">Changed</a></h3>
<h3 id="deprecated-16"><a class="header" href="#deprecated-16">Deprecated</a></h3>
<h3 id="removed-16"><a class="header" href="#removed-16">Removed</a></h3>
<h3 id="fixed-16"><a class="header" href="#fixed-16">Fixed</a></h3>
<h3 id="security-16"><a class="header" href="#security-16">Security</a></h3>
<h2 id="0824---2026-02-13"><a class="header" href="#0824---2026-02-13">[0.8.24] - 2026-02-13</a></h2>
<h3 id="added-17"><a class="header" href="#added-17">Added</a></h3>
<h3 id="changed-17"><a class="header" href="#changed-17">Changed</a></h3>
<h3 id="deprecated-17"><a class="header" href="#deprecated-17">Deprecated</a></h3>
<h3 id="removed-17"><a class="header" href="#removed-17">Removed</a></h3>
<h3 id="fixed-17"><a class="header" href="#fixed-17">Fixed</a></h3>
<h3 id="security-17"><a class="header" href="#security-17">Security</a></h3>
<h2 id="0823---2026-02-13"><a class="header" href="#0823---2026-02-13">[0.8.23] - 2026-02-13</a></h2>
<h3 id="added-18"><a class="header" href="#added-18">Added</a></h3>
<ul>
<li><strong>Multi-select preferred models per provider</strong>: The LLMs page now has a
“Preferred Models” button per provider that opens a multi-select modal.
Selected models are pinned at the top of the session model dropdown.
New <code>providers.save_models</code> RPC accepts multiple model IDs at once.</li>
<li><strong>Multi-select model picker in onboarding</strong>: The onboarding provider step now
uses a multi-select model picker matching the Settings LLMs page. Toggle
models on/off, see per-model probe status badges, and batch-save with a
single Save button. Previously-saved preferred models are pre-selected when
re-opening the model selector.</li>
</ul>
<h3 id="changed-18"><a class="header" href="#changed-18">Changed</a></h3>
<ul>
<li><strong>Model discovery uses <code>DiscoveredModel</code> struct</strong>: Replaced <code>(String, String)</code>
tuples with a typed <code>DiscoveredModel</code> struct across all providers (OpenAI,
GitHub Copilot, OpenAI Codex). The struct carries an optional <code>created_at</code>
timestamp from the <code>/v1/models</code> API, enabling discovered models to be sorted
newest-first. Preferred/configured models remain pinned at the top.</li>
<li><strong>Removed OpenAI-specific model name filtering from discovery</strong>: The
<code>/v1/models</code> response is no longer filtered by OpenAI naming conventions
(<code>gpt-*</code>, <code>o1</code>, etc.). All valid model IDs from any provider are now
accepted. This fixes model discovery for third-party providers like
Moonshot whose model IDs don’t follow OpenAI naming.</li>
<li><strong>Disabled automatic model probe at startup</strong>: The background chat
completion probe that checked which models are supported is now
triggered on-demand by the web UI instead of running automatically
2 seconds after startup. With dynamic model discovery, the startup
probe was expensive and noisy (non-chat models like image, audio,
and video would log spurious warnings).</li>
<li><strong>Model test uses streaming for faster feedback</strong>: The “Testing…”
probe when selecting a model now uses streaming and returns on the
first token instead of waiting for a full non-streaming response.
Timeout reduced from 20s to 10s.</li>
<li><strong>Chosen models merge with config-defined priority</strong>: Models selected
via the UI are prepended to the saved models list and merged with
config-defined preferred models, so both sources contribute to
ordering.</li>
<li><strong>Dynamic cross-provider priority list</strong>: The model dropdown priority
is now a shared <code>Arc&lt;RwLock&lt;Vec&lt;String&gt;&gt;&gt;</code> updated at runtime when
models are saved, instead of a static <code>HashMap</code> built once at startup.</li>
<li><strong>Replaced hardcoded Ollama checks with <code>keyOptional</code> metadata</strong>: JS
files no longer check <code>provider.name === "ollama"</code> for behavior.
Instead, the backend exposes a <code>keyOptional</code> field on provider
metadata, making the UI provider-agnostic.</li>
</ul>
<h3 id="fixed-18"><a class="header" href="#fixed-18">Fixed</a></h3>
<ul>
<li><strong>Settings UI env vars now available process-wide</strong>: environment variables
set via Settings &gt; Environment were previously only injected into sandbox
commands. They are now also injected into the Moltis process at startup,
making them available to web search, embeddings, and provider API calls.</li>
</ul>
<h2 id="0814---2026-02-11"><a class="header" href="#0814---2026-02-11">[0.8.14] - 2026-02-11</a></h2>
<h3 id="security-18"><a class="header" href="#security-18">Security</a></h3>
<ul>
<li><strong>Disconnect all WS clients on credential change</strong>: WebSocket connections
opened before auth setup are now disconnected when credentials change
(password set/changed, passkey registered during setup, auth reset, last
credential removed). An <code>auth.credentials_changed</code> event notifies browsers
to redirect to <code>/login</code>. Existing sessions are also invalidated on password
change for defense-in-depth.</li>
</ul>
<h3 id="fixed-19"><a class="header" href="#fixed-19">Fixed</a></h3>
<ul>
<li><strong>Onboarding test for SOUL.md clear behavior</strong>: Fixed <code>identity_update_partial</code>
test to match the new empty-file behavior from v0.8.13.</li>
</ul>
<h2 id="0813---2026-02-11"><a class="header" href="#0813---2026-02-11">[0.8.13] - 2026-02-11</a></h2>
<h3 id="added-19"><a class="header" href="#added-19">Added</a></h3>
<ul>
<li><strong>Auto-create SOUL.md on first run</strong>: <code>SOUL.md</code> is now seeded with the
default soul text when the file doesn’t exist, mirroring how <code>moltis.toml</code>
is auto-created. If deleted, it re-seeds on next load.</li>
</ul>
<h3 id="fixed-20"><a class="header" href="#fixed-20">Fixed</a></h3>
<ul>
<li><strong>SOUL.md clear via settings</strong>: Clearing the soul textarea in settings no
longer re-creates the default on the next load. An explicit clear now writes
an empty file to distinguish “user cleared soul” from “file never existed”.</li>
<li><strong>Onboarding WS connection timing</strong>: Deferred WebSocket connection until
authentication completes, preventing connection failures during onboarding.</li>
</ul>
<h3 id="changed-19"><a class="header" href="#changed-19">Changed</a></h3>
<ul>
<li><strong>Passkey auth preselection</strong>: Onboarding now preselects the passkey
authentication method when a passkey is already registered.</li>
<li><strong>Moonshot provider</strong>: Added Moonshot to the default offered providers list.</li>
</ul>
<h2 id="0812---2026-02-11"><a class="header" href="#0812---2026-02-11">[0.8.12] - 2026-02-11</a></h2>
<h3 id="fixed-21"><a class="header" href="#fixed-21">Fixed</a></h3>
<ul>
<li><strong>E2E test CI stability</strong>: <code>NoopChatService::clear()</code> now returns Ok instead
of an error when no LLM providers are configured, fixing 5 e2e test failures
in CI environments. Hardened websocket, chat-input, and onboarding-auth e2e
tests against startup race conditions and flaky selectors.</li>
</ul>
<h2 id="088---2026-02-11"><a class="header" href="#088---2026-02-11">[0.8.8] - 2026-02-11</a></h2>
<h3 id="changed-20"><a class="header" href="#changed-20">Changed</a></h3>
<ul>
<li><strong>Sessions sidebar layout</strong>: Removed the top <code>Sessions</code> title row and moved
the new-session <code>+</code> action next to the session search field for a more
compact list header.</li>
<li><strong>Identity autosave UX</strong>: Name fields in Settings &gt; Identity now autosave on
input blur, matching the quick-save behavior used for emoji selection.</li>
<li><strong>Favicon behavior by browser</strong>: Identity emoji changes now update favicon
live; Safari-specific reload guidance is shown only when Safari is detected.</li>
<li><strong>Page title format</strong>: Browser title now uses the configured assistant name
only, without appending <code>AI assistant</code> suffix text.</li>
</ul>
<h2 id="087---2026-02-11"><a class="header" href="#087---2026-02-11">[0.8.7] - 2026-02-11</a></h2>
<h3 id="added-20"><a class="header" href="#added-20">Added</a></h3>
<ul>
<li><strong>Model allowlist probe output support</strong>: Model allowlist matching now handles
provider probe output more robustly and applies stricter matching semantics.</li>
<li><strong>Ship helper command</strong>: Added a <code>just ship</code> task and <code>scripts/ship-pr.sh</code>
helper to streamline commit, push, PR update, and local validation workflows.</li>
</ul>
<h3 id="changed-21"><a class="header" href="#changed-21">Changed</a></h3>
<ul>
<li><strong>Gateway titles and labels</strong>: Login/onboarding page titles now consistently
use configured values and identity emoji; UI copy now labels providers as
<code>LLM</code> where appropriate.</li>
<li><strong>Release binary profile</strong>: Enabled ThinLTO and binary stripping in the
release profile to reduce artifact size.</li>
<li><strong>SPA route handling</strong>: Centralized SPA route definitions and preserved TOML
comments during config updates.</li>
</ul>
<h3 id="fixed-22"><a class="header" href="#fixed-22">Fixed</a></h3>
<ul>
<li><strong>Auth setup hardening</strong>: Enforced authentication immediately after password
or passkey setup to prevent unintended post-setup unauthenticated access.</li>
<li><strong>Streaming event ordering</strong>: Preserved gateway chat stream event ordering to
avoid out-of-order UI updates during streaming responses.</li>
<li><strong>Sandbox fallback pathing</strong>: Exec fallback now uses the host data directory
when no container runtime is available.</li>
</ul>
<h2 id="086---2026-02-11"><a class="header" href="#086---2026-02-11">[0.8.6] - 2026-02-11</a></h2>
<h3 id="changed-22"><a class="header" href="#changed-22">Changed</a></h3>
<ul>
<li><strong>Release workflow gates E2E tests</strong>: Build Packages workflow now runs E2E
tests and blocks all package builds (deb, rpm, arch, AppImage, snap,
Homebrew, Docker) if they fail.</li>
</ul>
<h3 id="fixed-23"><a class="header" href="#fixed-23">Fixed</a></h3>
<ul>
<li><strong>Docker TLS setup</strong>: All Docker examples now expose port 13132 for CA
certificate download with instructions to trust the self-signed cert,
fixing HTTPS access in Safari and other strict browsers.</li>
<li><strong>E2E onboarding-auth test</strong>: The <code>auth</code> Playwright project’s <code>testMatch</code>
regex <code>/auth\.spec/</code> also matched <code>onboarding-auth.spec.js</code>, causing it to
run against the default gateway (wrong server) instead of the onboarding-auth
gateway. Tightened regex to <code>/\/auth\.spec/</code>.</li>
</ul>
<h2 id="085---2026-02-11"><a class="header" href="#085---2026-02-11">[0.8.5] - 2026-02-11</a></h2>
<h3 id="added-21"><a class="header" href="#added-21">Added</a></h3>
<ul>
<li><strong>CLI <code>--version</code> flag</strong>: <code>moltis --version</code> now prints the version.</li>
<li><strong>Askama HTML rendering</strong>: SPA index and social metadata templates use
Askama instead of string replacement.</li>
</ul>
<h3 id="fixed-24"><a class="header" href="#fixed-24">Fixed</a></h3>
<ul>
<li><strong>WebSocket reconnect after remote onboarding auth</strong>: Connection now
reconnects immediately after auth setup instead of waiting for the backoff
timer, fixing “WebSocket not connected” errors during identity save.</li>
<li><strong>Passkeys on Fly.io</strong>: Auto-detect WebAuthn RP ID from <code>FLY_APP_NAME</code>
environment variable (constructs <code>{app}.fly.dev</code>).</li>
<li><strong>PaaS proxy detection</strong>: Added explicit <code>MOLTIS_BEHIND_PROXY=true</code> to
<code>render.yaml</code> and <code>fly.toml</code> so auth middleware reliably detects remote
connections behind the platform’s reverse proxy.</li>
<li><strong>WebAuthn origin scheme on PaaS</strong>: Non-localhost RP IDs now default to
<code>https://</code> origin since PaaS platforms terminate TLS at the proxy.</li>
</ul>
<h3 id="security-19"><a class="header" href="#security-19">Security</a></h3>
<ul>
<li><strong>Compaction prompt injection hardening</strong>: Session compaction now passes
typed <code>ChatMessage</code> objects to the summarizer LLM instead of concatenated
<code>{role}: {content}</code> text, preventing role-spoofing prompt injection where
user content could mimic role prefixes (similar to GHSA-g8p2-7wf7-98mq).</li>
</ul>
<h2 id="084---2026-02-11"><a class="header" href="#084---2026-02-11">[0.8.4] - 2026-02-11</a></h2>
<h3 id="changed-23"><a class="header" href="#changed-23">Changed</a></h3>
<ul>
<li><strong>Session delete UX</strong>: Forked sessions with no new messages beyond the fork
point are deleted immediately without a confirmation dialog.</li>
</ul>
<h3 id="fixed-25"><a class="header" href="#fixed-25">Fixed</a></h3>
<ul>
<li><strong>Localhost passkey compatibility</strong>: Gateway startup URLs and TLS redirect
hints now use <code>localhost</code> for loopback hosts, while WebAuthn also allows
<code>moltis.localhost</code> as an additional origin when RP ID is <code>localhost</code>.</li>
</ul>
<h2 id="083---2026-02-11"><a class="header" href="#083---2026-02-11">[0.8.3] - 2026-02-11</a></h2>
<h3 id="fixed-26"><a class="header" href="#fixed-26">Fixed</a></h3>
<ul>
<li><strong>Linux clippy <code>unused_mut</code> failure</strong>: Fixed a target-specific <code>unused_mut</code>
warning in browser stale-container cleanup that failed release clippy on
Linux with <code>-D warnings</code>.</li>
</ul>
<h2 id="082---2026-02-11"><a class="header" href="#082---2026-02-11">[0.8.2] - 2026-02-11</a></h2>
<h3 id="fixed-27"><a class="header" href="#fixed-27">Fixed</a></h3>
<ul>
<li><strong>Release clippy environment parity</strong>: The release workflow clippy job now
runs in the same CUDA-capable environment as main CI, includes the llama
source git bootstrap step, and installs <code>rustfmt</code> alongside <code>clippy</code>. This
fixes release clippy failures caused by missing CUDA toolchain/runtime.</li>
</ul>
<h2 id="081---2026-02-11"><a class="header" href="#081---2026-02-11">[0.8.1] - 2026-02-11</a></h2>
<h3 id="fixed-28"><a class="header" href="#fixed-28">Fixed</a></h3>
<ul>
<li><strong>Clippy validation parity</strong>: Unified local validation, CI (main), and
release workflows to use the same clippy command and flags
(<code>--workspace --all-features --all-targets --timings -D warnings</code>), which
prevents release-only clippy failures from command drift.</li>
</ul>
<h2 id="080---2026-02-11"><a class="header" href="#080---2026-02-11">[0.8.0] - 2026-02-11</a></h2>
<h3 id="added-22"><a class="header" href="#added-22">Added</a></h3>
<ul>
<li><strong>Instance-scoped container naming</strong>: Browser and sandbox container/image
prefixes now derive from the configured instance name, so multiple Moltis
instances do not collide.</li>
</ul>
<h3 id="changed-24"><a class="header" href="#changed-24">Changed</a></h3>
<ul>
<li><strong>Stale container cleanup targeting</strong>: Startup cleanup now removes only
containers that belong to the active instance prefix instead of sweeping
unrelated containers.</li>
<li><strong>Apple container runtime probing</strong>: Browser container backend checks now use
the modern Apple container CLI flow (<code>container image pull --help</code>) without
legacy fallback behavior.</li>
</ul>
<h3 id="fixed-29"><a class="header" href="#fixed-29">Fixed</a></h3>
<ul>
<li><strong>Release workflow artifacts</strong>: Disabled docker build record artifact uploads
in release CI to avoid release workflow failures from missing artifact paths.</li>
<li><strong>Release preflight consistency</strong>: Pinned nightly toolchain and aligned
release preflight checks with CI formatting/lint gates.</li>
</ul>
<h2 id="071---2026-02-11"><a class="header" href="#071---2026-02-11">[0.7.1] - 2026-02-11</a></h2>
<h3 id="fixed-30"><a class="header" href="#fixed-30">Fixed</a></h3>
<ul>
<li><strong>Release format gate</strong>: Included missing Rust formatting updates in release
history so the release workflow <code>cargo fmt --all -- --check</code> passes for
tagged builds.</li>
</ul>
<h2 id="070---2026-02-11"><a class="header" href="#070---2026-02-11">[0.7.0] - 2026-02-11</a></h2>
<h3 id="added-23"><a class="header" href="#added-23">Added</a></h3>
<ul>
<li><strong>HTTP endpoint throttling</strong>: Added gateway-level per-IP rate limits for
login (<code>/api/auth/login</code>), auth API routes, general API routes, and WebSocket
upgrades, with <code>429</code> responses, <code>Retry-After</code> headers, and JSON
<code>retry_after_seconds</code>.</li>
<li><strong>Login retry UX</strong>: The login page now disables the password Sign In button
while throttled and shows a live <code>Retry in Xs</code> countdown.</li>
</ul>
<h3 id="changed-25"><a class="header" href="#changed-25">Changed</a></h3>
<ul>
<li><strong>Auth-aware throttling policy</strong>: IP throttling is now bypassed when auth is
not required for the current request (authenticated requests, auth-disabled
mode, and local Tier-2 setup mode). This keeps brute-force protection for
unauthenticated/auth-required traffic while avoiding localhost friction.</li>
<li><strong>Login error copy</strong>: During throttled login retries, the error message stays
static while the retry countdown is shown only on the button.</li>
</ul>
<h3 id="documentation"><a class="header" href="#documentation">Documentation</a></h3>
<ul>
<li>Added throttling/security notes to <code>README.md</code>, <code>docs/src/index.md</code>,
<code>docs/src/authentication.md</code>, and <code>docs/src/security.md</code>.</li>
</ul>
<h2 id="061---2026-02-10"><a class="header" href="#061---2026-02-10">[0.6.1] - 2026-02-10</a></h2>
<h3 id="fixed-31"><a class="header" href="#fixed-31">Fixed</a></h3>
<ul>
<li><strong>Release clippy</strong>: Aligned release workflow clippy command with nightly
flags (<code>-Z unstable-options</code>, <code>--timings</code>).</li>
<li><strong>Test lint attributes</strong>: Fixed useless outer <code>#[allow]</code> on test module
<code>use</code> statement; replaced <code>.unwrap()</code> with <code>.expect()</code> in auth route tests.</li>
</ul>
<h2 id="060---2026-02-10"><a class="header" href="#060---2026-02-10">[0.6.0] - 2026-02-10</a></h2>
<h3 id="added-24"><a class="header" href="#added-24">Added</a></h3>
<ul>
<li><strong><code>BeforeLLMCall</code> / <code>AfterLLMCall</code> hooks</strong>: New modifying hook events that fire
before sending prompts to the LLM provider and after receiving responses
(before tool execution). Enables prompt injection filtering, PII redaction,
and response auditing via shell hooks.</li>
<li><strong>Config template</strong>: The generated <code>moltis.toml</code> template now lists all 17
hook events with correct PascalCase names and one-line descriptions.</li>
<li><strong>Hook event validation</strong>: <code>moltis config check</code> now warns on unknown hook
event names in the config file.</li>
<li><strong>Authentication docs</strong>: Comprehensive <code>docs/src/authentication.md</code> with
decision matrix, credential types, API key scopes, session endpoints,
and WebSocket auth documentation.</li>
</ul>
<h3 id="fixed-32"><a class="header" href="#fixed-32">Fixed</a></h3>
<ul>
<li><strong>Browser container lifecycle</strong>: Browser containers (browserless/chrome)
now have proper lifecycle management — periodic cleanup removes idle
instances every 30 seconds, graceful shutdown stops all containers on
Ctrl+C, and <code>sessions.clear_all</code> immediately closes all browser sessions.
A <code>Drop</code> safety net ensures containers are stopped even on unexpected exits.</li>
</ul>
<h3 id="changed-26"><a class="header" href="#changed-26">Changed</a></h3>
<ul>
<li><strong>Unified auth gate</strong>: All auth decision logic is now in a single
<code>check_auth()</code> function called by one <code>auth_gate</code> middleware. This fixes
the split-brain bug where passkey-only setups (no password) were treated
differently by 4 out of 5 auth code paths — the middleware used
<code>is_setup_complete()</code> (correct) while the others used <code>has_password()</code>
(incorrect for passkey-only setups).</li>
<li><strong>Hooks documentation</strong>: Rewritten <code>docs/src/hooks.md</code> with complete event
reference, corrected <code>ToolResultPersist</code> classification (modifying, not
read-only), and new “Prompt Injection Filtering” section with examples.</li>
<li><strong>Logs level filter UI</strong>: Settings -&gt; Logs now shows <code>DEBUG</code>/<code>TRACE</code> level
options only when they are enabled by the active tracing filter (including
target-specific directives). Default view remains <code>INFO</code> and above.</li>
<li><strong>Logs level filter control</strong>: Settings -&gt; Logs now uses the same combo
dropdown pattern as the chat model selector for consistent UX.</li>
<li><strong>Branch favicon contrast</strong>: Non-main branches now use a high-contrast purple
favicon variant so branch sessions are visually distinct from <code>main</code>.</li>
</ul>
<h3 id="security-20"><a class="header" href="#security-20">Security</a></h3>
<ul>
<li><strong>Content-Security-Policy header</strong>: HTML pages now include a nonce-based CSP
header (<code>script-src 'self' 'nonce-&lt;UUID&gt;'</code>), preventing inline script
injection (XSS defense-in-depth). The OAuth callback page also gets a
restrictive CSP.</li>
<li><strong>Passkey-only auth fix</strong>: Fixed authentication bypass where passkey-only
setups (without a password) would incorrectly allow unauthenticated access
on local connections, because the <code>has_password()</code> check returned false
even though <code>is_setup_complete()</code> was true.</li>
</ul>
<h2 id="050---2026-02-09"><a class="header" href="#050---2026-02-09">[0.5.0] - 2026-02-09</a></h2>
<h3 id="added-25"><a class="header" href="#added-25">Added</a></h3>
<ul>
<li><strong><code>moltis doctor</code> command</strong>: Comprehensive health check that validates config,
audits security (file permissions, API keys in config), checks directory and
database health, verifies provider readiness (API keys via config or env vars),
inspects TLS certificates, and validates MCP server commands on PATH.</li>
</ul>
<h3 id="security-21"><a class="header" href="#security-21">Security</a></h3>
<ul>
<li><strong>npm install –ignore-scripts</strong>: Skill dependency installation now passes
<code>--ignore-scripts</code> to npm, preventing supply chain attacks via malicious
postinstall scripts in npm packages.</li>
<li><strong>API key scope enforcement</strong>: API keys with empty/no scopes are now denied
access instead of silently receiving full admin privileges. Keys must specify
at least one scope explicitly (least-privilege by default).</li>
</ul>
<h2 id="041---2026-02-09"><a class="header" href="#041---2026-02-09">[0.4.1] - 2026-02-09</a></h2>
<h3 id="fixed-33"><a class="header" href="#fixed-33">Fixed</a></h3>
<ul>
<li><strong>Clippy lint in map test</strong>: Replace <code>is_some()</code>/<code>unwrap()</code> with <code>if let Some</code> to
fix <code>clippy::unnecessary_unwrap</code> that broke the v0.4.0 release build.</li>
</ul>
<h2 id="040---2026-02-09"><a class="header" href="#040---2026-02-09">[0.4.0] - 2026-02-09</a></h2>
<h3 id="added-26"><a class="header" href="#added-26">Added</a></h3>
<ul>
<li><strong>Auto-import external OAuth tokens</strong>: At startup, auto-detected provider
tokens (e.g. Codex CLI <code>~/.codex/auth.json</code>) are imported into the central
<code>oauth_tokens.json</code> store so users can manage all providers from the UI.</li>
<li><strong>Passkey onboarding</strong>: The security setup step now offers passkey registration
(Touch ID, Face ID, security keys) as the recommended default, with password
as a fallback option.</li>
<li><strong><code>providers.validate_key</code> RPC method</strong>: Test provider credentials without
saving them — builds a temporary registry, probes with a “ping” message, and
returns validation status with available models.</li>
<li><strong><code>providers.save_model</code> RPC method</strong>: Save the preferred model for any
configured provider without changing credentials.</li>
<li><strong><code>models.test</code> RPC method</strong>: Test a single model from the live registry with
a real LLM request before committing to it.</li>
<li><strong>Model selection for auto-detected providers</strong>: The Providers settings page
now shows a “Select Model” button for providers that have available models but
no preferred model set. This lets users pick their favorite model for
auto-detected providers (e.g. OpenAI Codex detected from <code>~/.codex/auth.json</code>).</li>
<li><strong><code>show_map</code> tool</strong>: New LLM-callable tool that composes a static map image
from OSM tiles with red/blue marker pins (destination + user location), plus
clickable links to Google Maps, Apple Maps, and OpenStreetMap. Supports
<code>user_latitude</code>/<code>user_longitude</code> to show both positions with auto-zoom.
Solves the “I can’t share links” problem in voice mode.</li>
<li><strong>Location precision modes</strong>: The <code>get_user_location</code> tool now accepts a
<code>precision</code> parameter — <code>"precise"</code> (GPS-level, default) for nearby places
and directions, or <code>"coarse"</code> (city-level, faster) for flights, weather, and
time zones. The LLM picks the appropriate mode based on the user’s query.</li>
</ul>
<h3 id="changed-27"><a class="header" href="#changed-27">Changed</a></h3>
<ul>
<li>Show “No LLM Providers Connected” card instead of welcome greeting when no
providers are configured.</li>
<li><strong>Onboarding provider setup</strong>: Credentials are now validated before saving.
After successful validation, a model selector shows available models for the
provider. The selected model is tested with a real request before completing
setup. Clear error messages are shown for common failures (invalid API key,
rate limits, connection issues).</li>
<li><strong>Settings provider setup</strong>: The main Providers settings page now uses the
same validate-first flow as onboarding. Credentials are validated before
saving (bad keys are never persisted), a model selector appears after
validation, and OAuth flows show model selection after authentication.</li>
</ul>
<h3 id="fixed-34"><a class="header" href="#fixed-34">Fixed</a></h3>
<ul>
<li><strong>Docker RAM detection</strong>: Fall back to <code>/proc/meminfo</code> when <code>sysinfo</code> returns
0 bytes for memory inside Docker/cgroup environments.</li>
<li><strong>MLX model suggested on Linux</strong>: Use backend-aware model suggestion so MLX
models are only suggested on Apple Silicon, not on Linux servers.</li>
<li><strong>Host package provisioning noise</strong>: Skip <code>apt-get</code> when running as non-root
with no passwordless sudo, instead of failing with permission denied warnings.</li>
<li><strong>Browser image pull without runtime</strong>: Guard browser container image pull to
skip when no usable container runtime is available (backend = “none”).</li>
<li><strong>OAuth token store logging</strong>: Replace silent <code>.ok()?</code> chains with explicit
<code>warn!</code>/<code>info!</code> logging in <code>TokenStore</code> load/save/delete for diagnosability.</li>
<li><strong>Provider warning noise</strong>: Downgrade “tokens not found” log from <code>warn!</code> to
<code>debug!</code> for unconfigured providers (GitHub Copilot, OpenAI Codex).</li>
<li><strong>models.detect_supported noise</strong>: Downgrade UNAVAILABLE RPC errors from
<code>warn!</code> to <code>debug!</code> since they indicate expected “not ready yet” states.</li>
</ul>
<h2 id="038---2026-02-09"><a class="header" href="#038---2026-02-09">[0.3.8] - 2026-02-09</a></h2>
<h3 id="changed-28"><a class="header" href="#changed-28">Changed</a></h3>
<ul>
<li><strong>Release CI parallelization</strong>: Split clippy and test into separate parallel
jobs in the release workflow for faster feedback on GitHub-hosted runners.</li>
</ul>
<h3 id="fixed-35"><a class="header" href="#fixed-35">Fixed</a></h3>
<ul>
<li><strong>CodSpeed workflow zizmor audit</strong>: Pinned <code>CodSpeedHQ/action@v4</code> to commit
SHA to satisfy zizmor’s <code>unpinned-uses</code> audit.</li>
</ul>
<h2 id="037---2026-02-09"><a class="header" href="#037---2026-02-09">[0.3.7] - 2026-02-09</a></h2>
<h3 id="fixed-36"><a class="header" href="#fixed-36">Fixed</a></h3>
<ul>
<li><strong>Clippy warnings</strong>: Fixed <code>MutexGuard</code> held across await in telegram
test, <code>field assignment outside initializer</code> in provider setup test, and
<code>items after test module</code> in gateway services.</li>
</ul>
<h2 id="036---2026-02-09"><a class="header" href="#036---2026-02-09">[0.3.6] - 2026-02-09</a></h2>
<h3 id="fixed-37"><a class="header" href="#fixed-37">Fixed</a></h3>
<ul>
<li><strong>Release CI zizmor audit</strong>: Removed <code>rust-cache</code> from the release workflow’s
clippy-test job entirely instead of using <code>save-if: false</code>, which zizmor does
not recognize as a cache-poisoning mitigation.</li>
</ul>
<h2 id="035---2026-02-09"><a class="header" href="#035---2026-02-09">[0.3.5] - 2026-02-09</a></h2>
<h3 id="fixed-38"><a class="header" href="#fixed-38">Fixed</a></h3>
<ul>
<li><strong>Release CI cache-poisoning</strong>: Set <code>save-if: false</code> on <code>rust-cache</code> in the
release workflow to satisfy zizmor’s cache-poisoning audit for tag-triggered
workflows that publish artifacts.</li>
</ul>
<h2 id="034---2026-02-09"><a class="header" href="#034---2026-02-09">[0.3.4] - 2026-02-09</a></h2>
<h3 id="fixed-39"><a class="header" href="#fixed-39">Fixed</a></h3>
<ul>
<li><strong>Session file lock contention</strong>: Replaced non-blocking <code>try_write()</code> with
blocking <code>write()</code> in <code>SessionStore::append()</code> and <code>replace_history()</code> so
concurrent tool-result persists wait for the file lock instead of failing
with <code>EAGAIN</code> (OS error 35).</li>
</ul>
<h3 id="changed-29"><a class="header" href="#changed-29">Changed</a></h3>
<ul>
<li><strong>Release CI quality gates</strong>: The Build Packages workflow now runs biome,
format, clippy, and test checks before building any packages, ensuring code
correctness before artifacts are produced.</li>
</ul>
<h2 id="033---2026-02-09"><a class="header" href="#033---2026-02-09">[0.3.3] - 2026-02-09</a></h2>
<h3 id="fixed-40"><a class="header" href="#fixed-40">Fixed</a></h3>
<ul>
<li><strong>OpenAI Codex token refresh panic</strong>: Made <code>get_valid_token()</code> async to fix
<code>block_on</code> inside async runtime panic when refreshing expired OAuth tokens.</li>
<li><strong>Channel session binding</strong>: Ensure session row exists before setting channel
binding, fixing <code>get_user_location</code> failures on first Telegram message.</li>
<li><strong>Cargo.lock sync</strong>: Lock file now matches workspace version.</li>
</ul>
<h2 id="030---2026-02-08"><a class="header" href="#030---2026-02-08">[0.3.0] - 2026-02-08</a></h2>
<h3 id="added-27"><a class="header" href="#added-27">Added</a></h3>
<ul>
<li>
<p><strong>Silent replies</strong>: The system prompt instructs the LLM to return an empty
response when tool output speaks for itself, suppressing empty chat bubbles,
push notifications, and channel replies. Empty assistant messages are not
persisted to session history.</p>
</li>
<li>
<p><strong>Persist TTS audio to session media</strong>: When TTS is enabled and the reply
medium is <code>voice</code>, the server generates TTS audio, saves it to the session
media directory, and includes the media path in the persisted assistant
message. On session reload the frontend renders an <code>&lt;audio&gt;</code> player from
the media API instead of re-generating audio via RPC.</p>
</li>
<li>
<p><strong>Per-session media directory</strong>: Screenshots from the browser tool are now
persisted to <code>sessions/media/&lt;key&gt;/</code> and served via
<code>GET /api/sessions/:key/media/:filename</code>. Session history reload renders
screenshots from the API instead of losing them. Media files are cleaned
up when a session is deleted.</p>
</li>
<li>
<p><strong>Process tool for interactive terminal sessions</strong>: New <code>process</code> tool lets
the LLM manage interactive/TUI programs (htop, vim, REPLs, etc.) via tmux
sessions inside the sandbox. Supports start, poll, send_keys, paste, kill,
and list actions. Includes a built-in <code>tmux</code> skill with usage instructions.</p>
</li>
<li>
<p><strong>Runtime host+sandbox prompt context</strong>: Chat system prompts now include a
<code>## Runtime</code> section with host details (hostname, OS, arch, shell, provider,
model, session, sudo non-interactive capability) and <code>exec</code> sandbox details
(enabled state, mode, backend, scope, image, workspace mount, network policy,
session override). Tool-mode prompts also add routing guidance so the agent
asks before requesting host installs or changing sandbox mode.</p>
</li>
<li>
<p><strong>Telegram location sharing</strong>: Telegram channels now support receiving shared
locations and live location updates. Live locations are tracked until they
expire or the user stops sharing.</p>
</li>
<li>
<p><strong>Telegram reply threading</strong>: Telegram channel replies now use
<code>reply_to_message_id</code> to thread responses under the original user message,
keeping conversations visually grouped in the chat.</p>
</li>
<li>
<p><strong><code>get_user_location</code> tool</strong>: New browser-based geolocation tool lets the LLM
request the user’s current coordinates via the Geolocation API, with a
permission prompt in the UI.</p>
</li>
<li>
<p><strong><code>sandbox_packages</code> tool</strong>: New tool for on-demand package discovery inside
the sandbox, allowing the LLM to query available and installable packages at
runtime.</p>
</li>
<li>
<p><strong>Sandbox package expansions</strong>: Pre-built sandbox images now include expanded
package groups — GIS/OpenStreetMap, document/office/search,
image/audio/media/data-processing, and communication packages. Mise is also
available for runtime version management.</p>
</li>
<li>
<p><strong>Queued message UI</strong>: When a message is submitted while the LLM is already
responding, it is shown in a dedicated bottom tray with cancel support.
Queued messages are moved into the conversation only after the current
response finishes rendering.</p>
</li>
<li>
<p><strong>Full context view</strong>: New “Context” button in the chat header opens a panel
showing the full LLM messages array sent to the provider, with a Copy button
for easy debugging.</p>
</li>
<li>
<p><strong>Browser timezone auto-detection</strong>: The gateway now auto-detects the user’s
timezone from the browser via <code>Intl.DateTimeFormat</code> and includes it in
session context, removing the need for manual timezone configuration.</p>
</li>
<li>
<p><strong>Logs download</strong>: New Download button on the logs page streams the JSONL log
file via <code>GET /api/logs/download</code> with gzip/zstd compression.</p>
</li>
<li>
<p><strong>Gateway middleware hardening</strong>: Consolidated middleware into
<code>apply_middleware_stack()</code> with security and observability layers:</p>
<ul>
<li>Replace <code>allow_origin(Any)</code> with dynamic host-based CORS validation
reusing the WebSocket CSWSH <code>is_same_origin</code> logic, safe for
Docker/cloud deployments with unknown hostnames</li>
<li><code>CatchPanicLayer</code> to convert handler panics to 500 responses</li>
<li><code>RequestBodyLimitLayer</code> (16 MiB) to prevent memory exhaustion</li>
<li><code>SetSensitiveHeadersLayer</code> to redact Authorization/Cookie in traces</li>
<li>Security response headers (<code>X-Content-Type-Options</code>, <code>X-Frame-Options</code>,
<code>Referrer-Policy</code>)</li>
<li><code>SetRequestIdLayer</code> + <code>PropagateRequestIdLayer</code> for <code>x-request-id</code>
correlation across HTTP request logs</li>
<li>zstd compression alongside gzip for better ratios</li>
</ul>
</li>
<li>
<p><strong>Message run tracking</strong>: Persisted messages now carry <code>run_id</code> and <code>seq</code>
fields for parent/child linking across multi-turn tool runs, plus a
client-side sequence number for ordering diagnostics.</p>
</li>
<li>
<p><strong>Cache token metrics</strong>: Provider responses now populate cache-hit and
cache-miss token counters in the metrics subsystem.</p>
</li>
</ul>
<h3 id="changed-30"><a class="header" href="#changed-30">Changed</a></h3>
<ul>
<li><strong>Provider auto-detection observability</strong>: When no explicit provider settings are present in <code>moltis.toml</code>, startup now logs each auto-detected provider with its source (<code>env</code>, config file key, OAuth token file, provider key file, or Codex auth file). Added <code>server.http_request_logs</code> (Axum HTTP traces) and <code>server.ws_request_logs</code> (WebSocket RPC request/response traces) config options (both default <code>false</code>) for on-demand transport debugging without code changes.</li>
<li><strong>Dynamic OpenAI Codex model catalog</strong>: OpenAI Codex providers now load model IDs from <code>https://chatgpt.com/backend-api/codex/models</code> at startup (with fallback defaults), and the gateway refreshes Codex models hourly so long-running sessions pick up newly available models (for example <code>gpt-5.3</code>) without restart.</li>
<li><strong>Model availability probing UX</strong>: Model support probing now runs in parallel with bounded concurrency, starts automatically after provider connect/startup, and streams live progress (<code>start</code>/<code>progress</code>/<code>complete</code>) over WebSocket so the Providers page can render a progress bar.</li>
<li><strong>Provider-scoped probing on connect</strong>: Connecting a provider from the Providers UI now probes only that provider’s models (instead of all providers), reducing noise and startup load when adding accounts one by one.</li>
<li><strong>Configurable model ordering</strong>: Added <code>chat.priority_models</code> in <code>moltis.toml</code> to pin preferred models at the top of model selectors without rebuilding. Runtime model selectors (<code>models.list</code>, chat model dropdown, Telegram <code>/model</code>) hide unsupported models, while Providers diagnostics continue to show full catalog entries (including unsupported flags).</li>
<li><strong>Configurable provider offerings in UI</strong>: Added <code>[providers] offered = [...]</code> allowlist in <code>moltis.toml</code> to control which providers are shown in onboarding/provider-picker UI. New config templates default this to <code>["openai", "github-copilot"]</code>; setting <code>offered = []</code> shows all known providers. Configured providers remain visible for management.</li>
</ul>
<h3 id="fixed-41"><a class="header" href="#fixed-41">Fixed</a></h3>
<ul>
<li>
<p><strong>Web search DuckDuckGo fallback</strong>: When no search API key (Brave or
Perplexity) is configured, <code>web_search</code> now automatically falls back to
DuckDuckGo HTML search instead of returning an error and forcing the LLM
to ask the user about using the browser.</p>
</li>
<li>
<p><strong>Web onboarding flash and redirect timing</strong>: The web server now performs onboarding redirects before rendering the main app shell. When onboarding is incomplete, non-onboarding routes redirect directly to <code>/onboarding</code>; once onboarding is complete, <code>/onboarding</code> redirects back to <code>/</code>. The onboarding route now serves a dedicated onboarding HTML/JS entry instead of the full app bundle, preventing duplicate bootstrap/navigation flashes in Safari.</p>
</li>
<li>
<p><strong>Local model cache path visibility</strong>: Startup logs for local LLM providers now explicitly print the model cache directory and cached model IDs, making <code>MOLTIS_DATA_DIR</code> behavior easier to verify without noisy model-catalog output.</p>
</li>
<li>
<p><strong>Kimi device-flow OAuth in web UI</strong>: Kimi OAuth now uses provider-specific headers and prefers <code>verification_uri_complete</code> (or synthesizes <code>?user_code=</code> fallback) so mobile-device sign-in links no longer fail with missing <code>user_code</code>.</p>
</li>
<li>
<p><strong>Kimi Code provider authentication compatibility</strong>: <code>kimi-code</code> is now API-key-first in the web UI (<code>KIMI_API_KEY</code>, default base URL <code>https://api.moonshot.ai/v1</code>), while still honoring previously stored OAuth tokens for backward compatibility. Provider errors now include a targeted hint to switch to API-key auth when Kimi returns <code>access_terminated_error</code>.</p>
</li>
<li>
<p><strong>Provider setup success feedback</strong>: API-key provider setup now runs an immediate model probe after saving credentials. The onboarding and Providers modal only show success when at least one model validates, and otherwise display a validation failure message instead of a false-positive “configured” state.</p>
</li>
<li>
<p><strong>Heartbeat/cron duplicate runs</strong>: Skip heartbeat LLM turn when no prompt is
configured, and fix duplicate cron job executions that could fire the same
scheduled run twice.</p>
</li>
<li>
<p><strong>Onboarding finish screen removed</strong>: Onboarding now skips the final
“congratulations” screen and redirects straight to the chat view.</p>
</li>
<li>
<p><strong>User message footer leak</strong>: Model name footer and timestamp are no longer
incorrectly attached to user messages in the chat UI.</p>
</li>
<li>
<p><strong>TTS counterpart auto-enable on STT save</strong>: Saving an ElevenLabs or Google
Cloud STT key now automatically enables the matching TTS provider, mirroring
the onboarding voice-test behavior.</p>
</li>
<li>
<p><strong>Voice-generating indicator removed</strong>: The separate “voice generating”
spinner during TTS playback has been removed in favor of the unified
response indicator.</p>
</li>
<li>
<p><strong>Config restart crash loop prevention</strong>: The gateway now validates the
configuration file before restarting, returning an error to the UI instead
of entering a crash loop when the config is invalid.</p>
</li>
<li>
<p><strong>Safari dev-mode cache busting</strong>: Development mode now busts the Safari
asset cache on reload, and fixes a missing border on detected-provider cards.</p>
</li>
</ul>
<h3 id="refactored"><a class="header" href="#refactored">Refactored</a></h3>
<ul>
<li><strong>McpManager lock consolidation</strong>: Replaced per-field <code>RwLock</code>s in
<code>McpManager</code> with a single <code>RwLock&lt;McpManagerInner&gt;</code> to reduce lock
contention and simplify state management.</li>
<li><strong>GatewayState lock consolidation</strong>: Replaced per-field <code>RwLock</code>s in
<code>GatewayState</code> with a single <code>RwLock&lt;GatewayInner&gt;</code> for the same reasons.</li>
<li><strong>Typed chat broadcast payloads</strong>: Chat WebSocket broadcasts now use typed
Rust structs instead of ad-hoc <code>serde_json::Value</code> maps.</li>
</ul>
<h3 id="documentation-1"><a class="header" href="#documentation-1">Documentation</a></h3>
<ul>
<li>Expanded default <code>SOUL.md</code> with the full OpenClaw reference text for agent
personality bootstrapping.</li>
</ul>
<h2 id="029---2026-02-08"><a class="header" href="#029---2026-02-08">[0.2.9] - 2026-02-08</a></h2>
<h3 id="added-28"><a class="header" href="#added-28">Added</a></h3>
<ul>
<li><strong>Voice provider policy controls</strong>: Added provider-list allowlists so config templates and runtime voice setup can explicitly limit shown/allowed TTS and STT providers.</li>
<li><strong>Typed voice provider metadata</strong>: Expanded voice provider metadata and preference handling to use typed flows across gateway and UI paths.</li>
</ul>
<h3 id="changed-31"><a class="header" href="#changed-31">Changed</a></h3>
<ul>
<li><strong>Reply medium preference handling</strong>: Chat now prefers the same reply medium when possible and falls back to text when a medium cannot be preserved.</li>
</ul>
<h3 id="fixed-42"><a class="header" href="#fixed-42">Fixed</a></h3>
<ul>
<li><strong>Chat UI reply badge visibility</strong>: Assistant footer now reliably shows the selected reply medium badge.</li>
<li><strong>Voice UX polish</strong>: Improved microphone timing behavior and preserved settings scroll state in voice configuration views.</li>
</ul>
<h2 id="028---2026-02-07"><a class="header" href="#028---2026-02-07">[0.2.8] - 2026-02-07</a></h2>
<h3 id="changed-32"><a class="header" href="#changed-32">Changed</a></h3>
<ul>
<li><strong>Unified plugins and skills into a single system</strong>: Plugins and skills were separate
systems with duplicate code, manifests, and UI pages. They are now merged into one
unified “Skills” system. All installed repos (SKILL.md, Claude Code <code>.claude-plugin/</code>,
Codex) are managed through a single <code>skills-manifest.json</code> and <code>installed-skills/</code>
directory. The <code>/plugins</code> page has been removed — everything is accessible from the
<code>/skills</code> page. A one-time startup migration automatically moves data from the old
plugins manifest and directory into the new unified location.</li>
<li><strong>Default config template voice list narrowed</strong>: New generated configs now include a
<code>[voice]</code> section with provider-list allowlists limited to ElevenLabs for TTS and
Mistral + ElevenLabs for STT.</li>
</ul>
<h3 id="fixed-43"><a class="header" href="#fixed-43">Fixed</a></h3>
<ul>
<li><strong>Update checker repository configuration</strong>: The update checker now reads
<code>server.update_repository_url</code> from <code>moltis.toml</code>, defaults new configs to
<code>https://github.com/moltis-org/moltis</code>, and treats an omitted/commented value
as explicitly disabled.</li>
<li><strong>Mistral and other providers rejecting requests with HTTP 422</strong>: Session metadata fields
(<code>created_at</code>, <code>model</code>, <code>provider</code>, <code>inputTokens</code>, <code>outputTokens</code>) were leaking into
provider API request bodies. Mistral’s strict validation rejected the extra <code>created_at</code>
field. Replaced <code>Vec&lt;serde_json::Value&gt;</code> with a typed <code>ChatMessage</code> enum in the
<code>LlmProvider</code> trait — metadata can no longer leak because the type only contains
LLM-relevant fields (<code>role</code>, <code>content</code>, <code>tool_calls</code>). Conversion from persisted JSON
happens once at the gateway boundary via <code>values_to_chat_messages()</code>.</li>
<li><strong>Chat skill creation not persisting new skills</strong>: Runtime tool filtering incorrectly
applied the union of discovered skill <code>allowed_tools</code> to all chat turns, which could
hide <code>create_skill</code>/<code>update_skill</code> and leave only a subset (for example <code>web_fetch</code>).
Chat runs now use configured tool policy for runtime filtering without globally
restricting tools based on discovered skill metadata.</li>
</ul>
<h3 id="added-29"><a class="header" href="#added-29">Added</a></h3>
<ul>
<li>
<p><strong>Voice Provider Management UI</strong>: Configure TTS and STT providers from Settings &gt; Voice</p>
<ul>
<li>Auto-detection of API keys from environment variables and LLM provider configs</li>
<li>Toggle switches to enable/disable providers without removing configuration</li>
<li>Local binary detection for whisper.cpp, piper, and sherpa-onnx</li>
<li>Server availability checks for Coqui TTS and Voxtral Local</li>
<li>Setup instructions modal for local provider installation</li>
<li>Shared Google Cloud API key between TTS and STT</li>
</ul>
</li>
<li>
<p><strong>Voice provider UI allowlists</strong>: Added <code>voice.tts.providers</code> and <code>voice.stt.providers</code>
config lists to control which TTS/STT providers are shown in the Settings UI.
Empty lists keep current behavior and show all providers.</p>
</li>
<li>
<p><strong>New TTS Providers</strong>:</p>
<ul>
<li>Google Cloud Text-to-Speech (380+ voices, 50+ languages)</li>
<li>Piper (fast local neural TTS, runs offline)</li>
<li>Coqui TTS (high-quality neural TTS with voice cloning)</li>
</ul>
</li>
<li>
<p><strong>New STT Providers</strong>:</p>
<ul>
<li>ElevenLabs Scribe (90+ languages, word timestamps, speaker diarization)</li>
<li>Mistral AI Voxtral (cloud-based, 13 languages)</li>
<li>Voxtral Local via vLLM (self-hosted with OpenAI-compatible API)</li>
</ul>
</li>
<li>
<p><strong>Browser Sandbox Mode</strong>: Run browser in isolated Docker containers for security</p>
<ul>
<li>Automatic container lifecycle management</li>
<li>Uses <code>browserless/chrome</code> image by default (configurable via <code>sandbox_image</code>)</li>
<li>Container readiness detection via HTTP endpoint probing</li>
<li>Browser sandbox mode automatically follows the session’s sandbox mode
(no separate <code>browser.sandbox</code> config - sandboxed sessions use sandboxed browser)</li>
</ul>
</li>
<li>
<p><strong>Memory-Based Browser Pool Limits</strong>: Browser instances now limited by system memory</p>
<ul>
<li><code>max_instances = 0</code> (default) allows unlimited instances, limited only by memory</li>
<li><code>memory_limit_percent = 90</code> blocks new instances when system memory exceeds threshold</li>
<li>Idle browsers cleaned up automatically before blocking</li>
<li>Set <code>max_instances &gt; 0</code> for hard limit if preferred</li>
</ul>
</li>
<li>
<p><strong>Automatic Browser Session Tracking</strong>: Browser tool automatically reuses sessions</p>
<ul>
<li>Session ID is tracked internally and injected when LLM doesn’t provide one</li>
<li>Prevents pool exhaustion from LLMs forgetting to pass session_id</li>
<li>Session cleared on explicit “close” action</li>
</ul>
</li>
<li>
<p><strong>HiDPI Screenshot Support</strong>: Screenshots scale correctly on Retina displays</p>
<ul>
<li><code>device_scale_factor</code> config (default: 2.0) for high-DPI rendering</li>
<li>Screenshot display in UI scales according to device pixel ratio</li>
<li>Viewport increased to 2560×1440 for sharper captures</li>
</ul>
</li>
<li>
<p><strong>Enhanced Screenshot Lightbox</strong>:</p>
<ul>
<li>Scrollable container for viewing long/tall screenshots</li>
<li>Download button at top of lightbox</li>
<li>Visible ✕ close button instead of text hint</li>
<li>Proper scaling for HiDPI displays</li>
</ul>
</li>
<li>
<p><strong>Telegram Screenshot Support</strong>: Browser screenshots sent to Telegram channels</p>
<ul>
<li>Automatic retry as document when image dimensions exceed Telegram limits</li>
<li>Error messages sent to channel when screenshot delivery fails</li>
<li>Handles <code>PHOTO_INVALID_DIMENSIONS</code> and <code>PHOTO_SAVE_FILE_INVALID</code> errors</li>
</ul>
</li>
<li>
<p><strong>Telegram Tool Status Notifications</strong>: See what’s happening during long operations</p>
<ul>
<li>Tool execution messages sent to Telegram (e.g., “🌐 Navigating to…”,
“💻 Running: <code>git status</code>”, “📸 Taking screenshot…”)</li>
<li>Messages sent silently (no notification sound) to avoid spam</li>
<li>Typing indicator automatically re-sent after status messages</li>
<li>Supports browser, exec, web_fetch, web_search, and memory tools</li>
</ul>
</li>
<li>
<p><strong>Log Target Display</strong>: Logs now include the crate/module path for easier debugging</p>
<ul>
<li>Example: <code>INFO moltis_gateway::chat: tool execution succeeded tool=browser</code></li>
</ul>
</li>
<li>
<p><strong>Contributor docs: local validation</strong>: Added documentation for the <code>./scripts/local-validate.sh</code> workflow, including published local status contexts, platform behavior, and CI fallback expectations.</p>
</li>
<li>
<p><strong>Hooks Web UI</strong>: New <code>/hooks</code> page to manage lifecycle hooks from the browser</p>
<ul>
<li>View all discovered hooks with eligibility status, source, and events</li>
<li>Enable/disable hooks without removing files (persisted across restarts)</li>
<li>Edit HOOK.md content in a monospace textarea and save back to disk</li>
<li>Reload hooks at runtime to pick up changes without restarting</li>
<li>Live stats (call count, failures, avg latency) from the hook registry</li>
<li>WebSocket-driven auto-refresh via <code>hooks.status</code> event</li>
<li>RPC methods: <code>hooks.list</code>, <code>hooks.enable</code>, <code>hooks.disable</code>, <code>hooks.save</code>, <code>hooks.reload</code></li>
</ul>
</li>
<li>
<p><strong>Deploy platform detection</strong>: New <code>MOLTIS_DEPLOY_PLATFORM</code> env var hides local-only providers (local-llm, Ollama) on cloud deployments. Pre-configured in Fly.io, DigitalOcean, and Render deploy templates.</p>
</li>
<li>
<p><strong>Telegram OTP self-approval</strong>: Non-allowlisted DM users receive a 6-digit verification code instead of being silently ignored. Correct code entry auto-approves the user to the allowlist. Includes flood protection (non-code messages silently ignored), lockout after 3 failed attempts (configurable cooldown), and 5-minute code expiry. OTP codes visible in web UI Senders tab. Controlled by <code>otp_self_approval</code> (default: true) and <code>otp_cooldown_secs</code> (default: 300) config fields.</p>
</li>
<li>
<p><strong>Update availability banner</strong>: The web UI now checks GitHub releases hourly and shows a top banner when a newer version of moltis is available, with a direct link to the release page.</p>
</li>
</ul>
<h3 id="changed-33"><a class="header" href="#changed-33">Changed</a></h3>
<ul>
<li><strong>Documentation safety notice</strong>: Added an upfront alpha-software warning on the docs landing page, emphasizing careful deployment, isolation, and strong auth/network controls for self-hosted AI assistants.</li>
<li><strong>Release packaging</strong>: Derive release artifact versions from the Git tag (<code>vX.Y.Z</code>) in CI, and sync package metadata during release jobs to prevent filename/version drift.</li>
<li><strong>Versioning</strong>: Bump workspace and snap baseline version to <code>0.2.0</code>.</li>
<li><strong>Onboarding auth flow</strong>: Route first-run setup directly into <code>/onboarding</code> and remove the separate <code>/setup</code> web UI page.</li>
<li><strong>Startup observability</strong>: Log each loaded context markdown (<code>CLAUDE.md</code> / <code>AGENTS.md</code> / <code>.claude/rules/*.md</code>), memory markdown (<code>MEMORY.md</code> and <code>memory/*.md</code>), and discovered <code>SKILL.md</code> to make startup/context loading easier to audit.</li>
<li><strong>Workspace root pathing</strong>: Standardize workspace-scoped file discovery/loading on <code>moltis_config::data_dir()</code> instead of process cwd (affects BOOT.md, hook discovery, skill discovery, and compaction memory output paths).</li>
<li><strong>Soul storage</strong>: Move agent personality text out of <code>moltis.toml</code> into workspace <code>SOUL.md</code>; identity APIs/UI still edit soul, but now persist it as a markdown file.</li>
<li><strong>Identity storage</strong>: Persist agent identity fields (<code>name</code>, <code>emoji</code>, <code>creature</code>, <code>vibe</code>) to workspace <code>IDENTITY.md</code> using YAML frontmatter; settings UI continues to edit these fields through the same RPC/API.</li>
<li><strong>User profile storage</strong>: Persist user profile fields (<code>name</code>, <code>timezone</code>) to workspace <code>USER.md</code> using YAML frontmatter; onboarding/settings continue to use the same API/UI while reading/writing the markdown file.</li>
<li><strong>Workspace markdown support</strong>: Add <code>TOOLS.md</code> prompt injection from workspace root (<code>data_dir</code>), and keep startup injection sourced from <code>BOOT.md</code>.</li>
<li><strong>Heartbeat prompt precedence</strong>: Support workspace <code>HEARTBEAT.md</code> as heartbeat prompt source with precedence <code>heartbeat.prompt</code> (config override) → <code>HEARTBEAT.md</code> → built-in default; log when config prompt overrides <code>HEARTBEAT.md</code>.</li>
<li><strong>Heartbeat UX</strong>: Expose effective heartbeat prompt source (<code>config</code>, <code>HEARTBEAT.md</code>, or default) via <code>heartbeat.status</code> and display it in the Heartbeat settings UI.</li>
<li><strong>BOOT.md onboarding aid</strong>: Seed a default workspace <code>BOOT.md</code> with in-file guidance describing startup injection behavior and recommended usage.</li>
<li><strong>Workspace context parity</strong>: Treat workspace <code>TOOLS.md</code> as general context (not only policy) and add workspace <code>AGENTS.md</code> injection support from <code>data_dir</code>.</li>
<li><strong>Heartbeat token guard</strong>: Skip heartbeat LLM turns when <code>HEARTBEAT.md</code> exists but is empty/comment-only and there is no explicit <code>heartbeat.prompt</code> override, reducing unnecessary token consumption.</li>
<li><strong>Exec approval policy wiring</strong>: Gateway now initializes exec approval mode/security level/allowlist from <code>moltis.toml</code> (<code>tools.exec.*</code>) instead of always using hardcoded defaults.</li>
<li><strong>Runtime tool enforcement</strong>: Chat runs now apply configured tool policy (<code>tools.policy</code>) and skill <code>allowed_tools</code> constraints when selecting callable tools.</li>
<li><strong>Skill trust lifecycle</strong>: Installed marketplace skills/plugins now track a <code>trusted</code> state and must be trusted before they can be enabled; the skills UI now surfaces untrusted status and supports trust-before-enable.</li>
<li><strong>Git metadata via gitoxide</strong>: Gateway now resolves branch names, repo HEAD SHAs, and commit timestamps using <code>gix</code> (gitoxide) instead of shelling out to <code>git</code> for those read-only operations.</li>
</ul>
<h3 id="fixed-44"><a class="header" href="#fixed-44">Fixed</a></h3>
<ul>
<li><strong>OAuth callback on hosted deployments</strong>: OpenAI Codex OAuth now uses the web app origin callback (<code>/auth/callback</code>) in the UI flow instead of hardcoded localhost loopback, allowing DigitalOcean/Fly/Render deployments to complete OAuth successfully.</li>
<li><strong>Sandbox startup on hosted Docker environments</strong>: Skip sandbox image pre-build when sandbox mode is off, and require Docker daemon accessibility (not just Docker CLI presence) before selecting the Docker sandbox backend.</li>
<li><strong>Homebrew release automation</strong>: Run the tap update in the release workflow after all package/image jobs complete so formula publishing does not race missing tarball assets.</li>
<li><strong>Docker runtime</strong>: Install <code>libgomp1</code> in the runtime image to satisfy OpenMP-linked binaries and prevent startup failures with <code>libgomp.so.1</code> missing.</li>
<li><strong>Release CI validation</strong>: Add a Docker smoke test step (<code>moltis --help</code>) after image build/push so missing runtime libraries fail in CI before release.</li>
<li><strong>Web onboarding clarity</strong>: Add setup-code guidance that points users to the process log (stdout).</li>
<li><strong>WebSocket auth (remote deployments)</strong>: Accept existing session/API-key auth from WebSocket upgrade headers so browser connections don’t immediately close after <code>connect</code> on hosted setups.</li>
<li><strong>Sandbox UX on unsupported hosts</strong>: Disable sandbox controls in chat/images when no runtime backend is detected, with a tooltip explaining cloud deploy limitations.</li>
<li><strong>Telegram OTP code echoed to LLM</strong>: After OTP self-approval, the verification code message was re-processed as a regular chat message because <code>sender_approve</code> restarted the bot polling loop (resetting the Telegram update offset). Sender approve/deny now hot-update the in-memory config without restarting the bot.</li>
<li><strong>Empty allowlist bypassed access control</strong>: When <code>dm_policy = Allowlist</code> and all entries were removed, the empty list was treated as “allow everyone” instead of “deny everyone”. An explicit Allowlist policy with an empty list now correctly denies all access.</li>
<li><strong>Browser sandbox timeout</strong>: Sandboxed browsers now use the configured
<code>navigation_timeout_ms</code> (default 30s) instead of a shorter internal timeout.
Previously, sandboxed browser connections could time out prematurely.</li>
<li><strong>Tall screenshot lightbox</strong>: Full-page screenshots now display at proper size
with vertical scrolling instead of being scaled down to fit the viewport.</li>
<li><strong>Telegram typing indicator for long responses</strong>: Channel replies now wait for outbound delivery tasks to finish before chat completion returns, so periodic <code>typing...</code> updates continue until the Telegram message is actually sent.</li>
<li><strong>Skills dependency install safety</strong>: <code>skills.install_dep</code> now requires explicit user confirmation and blocks host installs when sandbox mode is disabled (unless explicitly overridden in the RPC call).</li>
</ul>
<h3 id="security-22"><a class="header" href="#security-22">Security</a></h3>
<ul>
<li><strong>Asset response hardening</strong>: Static assets now set <code>X-Content-Type-Options: nosniff</code>, and SVG responses include a restrictive <code>Content-Security-Policy</code> (<code>script-src 'none'</code>, <code>object-src 'none'</code>) to reduce stored-XSS risk if user-controlled SVGs are ever introduced.</li>
<li><strong>Archive extraction hardening</strong>: Skills/plugin tarball installs now reject unsafe archive paths (<code>..</code>, absolute/path-prefix escapes) and reject symlink/hardlink archive entries to prevent path traversal and link-based escapes.</li>
<li><strong>Install provenance</strong>: Installed skill/plugin repo manifests now persist a pinned <code>commit_sha</code> (resolved from clone or API fallback) for future trust drift detection.</li>
<li><strong>Re-trust on source drift</strong>: If an installed git-backed repo’s HEAD commit changes from the pinned <code>commit_sha</code>, the gateway now marks its skills untrusted+disabled and requires trust again before re-enabling; the UI surfaces this as <code>source changed</code>.</li>
<li><strong>Security audit trail</strong>: Skill/plugin install, remove, trust, enable/disable, dependency install, and source-drift events are now appended to <code>~/.moltis/logs/security-audit.jsonl</code> for incident review.</li>
<li><strong>Emergency kill switch</strong>: Added <code>skills.emergency_disable</code> to immediately disable all installed third-party skills and plugins; exposed in the Skills UI as a one-click emergency action.</li>
<li><strong>Risky dependency install blocking</strong>: <code>skills.install_dep</code> now blocks suspicious install command patterns by default (e.g. piped shell payloads, base64 decode chains, quarantine bypass) unless explicitly overridden with <code>allow_risky_install=true</code>.</li>
<li><strong>Provenance visibility</strong>: Skills UI now displays pinned install commit SHA in repo and detail views to make source provenance easier to verify.</li>
<li><strong>Recent-commit risk warnings</strong>: Skill/plugin detail views now include commit links and commit-age indicators, with a prominent warning banner when the pinned commit is very recent.</li>
<li><strong>Installer subprocess reduction</strong>: Skills/plugins install paths now avoid <code>git</code> subprocess clone attempts and use GitHub tarball installs with pinned commit metadata.</li>
<li><strong>Install resilience for rapid multi-repo installs</strong>: Skills/plugins install now auto-clean stale on-disk directories that are missing from manifest state, and tar extraction skips link entries instead of failing the whole install.</li>
<li><strong>Orphaned repo visibility</strong>: Skills/plugins repo listing now surfaces manifest-missing directories found on disk as <code>orphaned</code> entries and allows removing them from the UI.</li>
<li><strong>Protected seed skills</strong>: Discovered template skills (<code>template-skill</code> / <code>template</code>) are now marked protected and cannot be deleted from the web UI.</li>
<li><strong>License review links</strong>: Skill/plugin license badges now link directly to repository license files when detectable (e.g. <code>LICENSE.txt</code>, <code>LICENSE.md</code>, <code>LICENSE</code>).</li>
<li><strong>Example skill seeding</strong>: Gateway now seeds <code>~/.moltis/skills/template-skill/SKILL.md</code> on startup when missing, so users always have a starter personal skill template.</li>
<li><strong>Memory indexing scope tightened</strong>: Memory sync now indexes only <code>MEMORY.md</code> / <code>memory.md</code> and <code>memory/</code> content by default (instead of scanning the entire data root), reducing irrelevant indexing noise from installed skills/plugins.</li>
<li><strong>Ollama embedding bootstrap</strong>: When using Ollama for memory embeddings, gateway now auto-attempts to pull missing embedding models (default <code>nomic-embed-text</code>) via Ollama HTTP API.</li>
</ul>
<h3 id="documentation-2"><a class="header" href="#documentation-2">Documentation</a></h3>
<ul>
<li>Added <code>docs/src/skills-security.md</code> with third-party skills/plugin hardening guidance (trust lifecycle, provenance pinning, source-drift re-trust, risky install guards, emergency disable, and security audit logging).</li>
</ul>
<h2 id="0110---2026-02-06"><a class="header" href="#0110---2026-02-06">[0.1.10] - 2026-02-06</a></h2>
<h3 id="changed-34"><a class="header" href="#changed-34">Changed</a></h3>
<ul>
<li><strong>CI builds</strong>: Build Docker images natively per architecture instead of QEMU emulation, then merge into multi-arch manifest</li>
</ul>
<h2 id="019---2026-02-06"><a class="header" href="#019---2026-02-06">[0.1.9] - 2026-02-06</a></h2>
<h3 id="changed-35"><a class="header" href="#changed-35">Changed</a></h3>
<ul>
<li><strong>CI builds</strong>: Migrate all release build jobs from self-hosted to GitHub-hosted runners for full parallelism (<code>ubuntu-latest</code>, <code>ubuntu-latest-arm</code>, <code>macos-latest</code>), remove all cross-compilation toolchain steps</li>
</ul>
<h2 id="018---2026-02-06"><a class="header" href="#018---2026-02-06">[0.1.8] - 2026-02-06</a></h2>
<h3 id="fixed-45"><a class="header" href="#fixed-45">Fixed</a></h3>
<ul>
<li><strong>CI builds</strong>: Fix corrupted cargo config on all self-hosted runner jobs, fix macOS runner label, add llama-cpp build deps to Docker and Snap builds</li>
</ul>
<h2 id="017---2026-02-06"><a class="header" href="#017---2026-02-06">[0.1.7] - 2026-02-06</a></h2>
<h3 id="fixed-46"><a class="header" href="#fixed-46">Fixed</a></h3>
<ul>
<li><strong>CI builds</strong>: Use project-local <code>.cargo/config.toml</code> for cross-compilation instead of appending to global config (fixes duplicate key errors on self-hosted runners)</li>
</ul>
<h2 id="016---2026-02-06"><a class="header" href="#016---2026-02-06">[0.1.6] - 2026-02-06</a></h2>
<h3 id="fixed-47"><a class="header" href="#fixed-47">Fixed</a></h3>
<ul>
<li><strong>CI builds</strong>: Use macOS GitHub-hosted runners for apple-darwin binary builds instead of cross-compiling from Linux</li>
<li><strong>CI performance</strong>: Run lightweight lint jobs (zizmor, biome, fmt) on GitHub-hosted runners to free up self-hosted runners</li>
</ul>
<h2 id="015---2026-02-06"><a class="header" href="#015---2026-02-06">[0.1.5] - 2026-02-06</a></h2>
<h3 id="fixed-48"><a class="header" href="#fixed-48">Fixed</a></h3>
<ul>
<li><strong>CI security</strong>: Use GitHub-hosted runners for PRs to prevent untrusted code from running on self-hosted infrastructure</li>
<li><strong>CI security</strong>: Add <code>persist-credentials: false</code> to docs workflow checkout (fixes zizmor artipacked warning)</li>
</ul>
<h2 id="014---2026-02-06"><a class="header" href="#014---2026-02-06">[0.1.4] - 2026-02-06</a></h2>
<h3 id="added-30"><a class="header" href="#added-30">Added</a></h3>
<ul>
<li>
<p><strong><code>--no-tls</code> CLI flag</strong>: <code>--no-tls</code> flag and <code>MOLTIS_NO_TLS</code> environment variable to disable
TLS for cloud deployments where the provider handles TLS termination</p>
</li>
<li>
<p><strong>One-click cloud deploy</strong>: Deploy configs for Fly.io (<code>fly.toml</code>), DigitalOcean
(<code>.do/deploy.template.yaml</code>), Render (<code>render.yaml</code>), and Railway (<code>railway.json</code>)
with deploy buttons in the README</p>
</li>
<li>
<p><strong>Config Check Command</strong>: <code>moltis config check</code> validates the configuration file, detects unknown/misspelled fields with Levenshtein-based suggestions, warns about security misconfigurations, and checks file references</p>
</li>
<li>
<p><strong>Memory Usage Indicator</strong>: Display process RSS and system free memory in the header bar, updated every 30 seconds via the tick WebSocket broadcast</p>
</li>
<li>
<p><strong>QMD Backend Support</strong>: Optional QMD (Query Memory Daemon) backend for hybrid search with BM25 + vector + LLM reranking</p>
<ul>
<li>Gated behind <code>qmd</code> feature flag (enabled by default)</li>
<li>Web UI shows installation instructions and QMD status</li>
<li>Comparison table between built-in SQLite and QMD backends</li>
</ul>
</li>
<li>
<p><strong>Citations</strong>: Configurable citation mode (on/off/auto) for memory search results</p>
<ul>
<li>Auto mode includes citations when results span multiple files</li>
</ul>
</li>
<li>
<p><strong>Session Export</strong>: Option to export session transcripts to memory for future reference</p>
</li>
<li>
<p><strong>LLM Reranking</strong>: Use LLM to rerank search results for improved relevance (requires QMD)</p>
</li>
<li>
<p><strong>Memory Documentation</strong>: Added <code>docs/src/memory.md</code> with comprehensive memory system documentation</p>
</li>
<li>
<p><strong>Mobile PWA Support</strong>: Install moltis as a Progressive Web App on iOS, Android, and desktop</p>
<ul>
<li>Standalone mode with full-screen experience</li>
<li>Custom app icon (crab mascot)</li>
<li>Service worker for offline support and caching</li>
<li>Safe area support for notched devices</li>
</ul>
</li>
<li>
<p><strong>Push Notifications</strong>: Receive alerts when the LLM responds</p>
<ul>
<li>VAPID key generation and storage for Web Push API</li>
<li>Subscribe/unsubscribe toggle in Settings &gt; Notifications</li>
<li>Subscription management UI showing device name, IP address, and date</li>
<li>Remove any subscription from any device</li>
<li>Real-time subscription updates via WebSocket</li>
<li>Client IP detection from X-Forwarded-For, X-Real-IP, CF-Connecting-IP headers</li>
<li>Notifications sent for both streaming and agent (tool-using) chat modes</li>
</ul>
</li>
<li>
<p><strong>Safari/iOS PWA Detection</strong>: Show “Add to Dock” instructions when push notifications
require PWA installation (Safari doesn’t support push in browser mode)</p>
</li>
<li>
<p><strong>Browser Screenshot Thumbnails</strong>: Screenshots from the browser tool now display as
clickable thumbnails in the chat UI</p>
<ul>
<li>Click to view fullscreen in a lightbox overlay</li>
<li>Press Escape or click anywhere to close</li>
<li>Thumbnails are 200×150px max with hover effects</li>
</ul>
</li>
<li>
<p><strong>Improved Browser Detection</strong>: Better cross-platform browser detection</p>
<ul>
<li>Checks macOS app bundles before PATH (avoids broken Homebrew chromium wrapper)</li>
<li>Supports Chrome, Chromium, Edge, Brave, Opera, Vivaldi, Arc</li>
<li>Shows platform-specific installation instructions when no browser found</li>
<li>Custom path via <code>chrome_path</code> config or <code>CHROME</code> environment variable</li>
</ul>
</li>
<li>
<p><strong>Vision Support for Screenshots</strong>: Vision-capable models can now interpret
browser screenshots instead of having them stripped from context</p>
<ul>
<li>Screenshots sent as multimodal image content blocks for GPT-4o, Claude, Gemini</li>
<li>Non-vision models continue to receive <code>[base64 data removed]</code> placeholder</li>
<li><code>supports_vision()</code> trait method added to <code>LlmProvider</code> for capability detection</li>
</ul>
</li>
<li>
<p><strong>Session state store</strong>: per-session key-value persistence scoped by
namespace, backed by SQLite (<code>session_state</code> tool).</p>
</li>
<li>
<p><strong>Session branching</strong>: <code>branch_session</code> tool forks a conversation at any
message index into an independent copy.</p>
</li>
<li>
<p><strong>Session fork from UI</strong>: Fork button in the chat header and sidebar action
buttons let users fork sessions without asking the LLM. Forked sessions
appear indented under their parent with a branch icon.</p>
</li>
<li>
<p><strong>Skill self-extension</strong>: <code>create_skill</code>, <code>update_skill</code>, <code>delete_skill</code>
tools let the agent manage project-local skills at runtime.</p>
</li>
<li>
<p><strong>Skill hot-reload</strong>: filesystem watcher on skill directories emits
<code>skills.changed</code> events via WebSocket when SKILL.md files change.</p>
</li>
<li>
<p><strong>Typed tool sources</strong>: <code>ToolSource</code> enum (<code>Builtin</code> / <code>Mcp { server }</code>)
replaces string-prefix identification of MCP tools in the tool registry.</p>
</li>
<li>
<p><strong>Tool registry metadata</strong>: <code>list_schemas()</code> now includes <code>source</code> and
<code>mcpServer</code> fields so the UI can group tools by origin.</p>
</li>
<li>
<p><strong>Per-session MCP toggle</strong>: sessions store an <code>mcp_disabled</code> flag; the chat
header exposes a toggle button to enable/disable MCP tools per session.</p>
</li>
<li>
<p><strong>Debug panel convergence</strong>: the debug side-panel now renders the same seven
sections as the <code>/context</code> slash command, eliminating duplicated rendering
logic.</p>
</li>
<li>
<p>Documentation pages for session state, session branching, skill
self-extension, and the tool registry architecture.</p>
</li>
</ul>
<h3 id="changed-36"><a class="header" href="#changed-36">Changed</a></h3>
<ul>
<li>
<p>Memory settings UI enhanced with backend comparison and feature explanations</p>
</li>
<li>
<p>Added <code>memory.qmd.status</code> RPC method for checking QMD availability</p>
</li>
<li>
<p>Extended <code>memory.config.get</code> to include <code>qmd_feature_enabled</code> flag</p>
</li>
<li>
<p>Push notifications feature is now enabled by default in the CLI</p>
</li>
<li>
<p><strong>TLS HTTP redirect port</strong> now defaults to <code>gateway_port + 1</code> instead of
the hardcoded port <code>18790</code>. This makes the Dockerfile simpler (both ports
are adjacent) and avoids collisions when running multiple instances.
Override via <code>[tls] http_redirect_port</code> in <code>moltis.toml</code> or the
<code>MOLTIS_TLS__HTTP_REDIRECT_PORT</code> environment variable.</p>
</li>
<li>
<p><strong>TLS certificates use <code>moltis.localhost</code> domain.</strong> Auto-generated server
certs now include <code>moltis.localhost</code>, <code>*.moltis.localhost</code>, <code>localhost</code>,
<code>127.0.0.1</code>, and <code>::1</code> as SANs. Banner and redirect URLs use
<code>https://moltis.localhost:&lt;port&gt;</code> when bound to loopback, so the cert
matches the displayed URL. Existing certs are automatically regenerated
on next startup.</p>
</li>
<li>
<p><strong>Certificate validity uses dynamic dates.</strong> Cert <code>notBefore</code>/<code>notAfter</code>
are now computed from the current system time instead of being hardcoded.
CA certs are valid for 10 years, server certs for 1 year from generation.</p>
</li>
<li>
<p><code>McpToolBridge</code> now stores and exposes <code>server_name()</code> for typed
registration.</p>
</li>
<li>
<p><code>mcp_service::sync_mcp_tools()</code> uses <code>unregister_mcp()</code> /
<code>register_mcp()</code> instead of scanning tool names by prefix.</p>
</li>
<li>
<p><code>chat.rs</code> uses <code>clone_without_mcp()</code> instead of
<code>clone_without_prefix("mcp__")</code> in all three call sites.</p>
</li>
</ul>
<h3 id="fixed-49"><a class="header" href="#fixed-49">Fixed</a></h3>
<ul>
<li>Push notifications not sending when chat uses agent mode (run_with_tools)</li>
<li>Missing space in Safari install instructions (“usingFile” → “using File”)</li>
<li><strong>WebSocket origin validation</strong> now treats <code>.localhost</code> subdomains
(e.g. <code>moltis.localhost</code>) as loopback equivalents per RFC 6761.</li>
<li><strong>Browser tool schema enforcement</strong>: Added <code>strict: true</code> and <code>additionalProperties: false</code>
to OpenAI-compatible tool schemas, improving model compliance with required fields</li>
<li><strong>Browser tool defaults</strong>: When model sends URL without action, defaults to <code>navigate</code>
instead of erroring</li>
<li><strong>Chat message ordering</strong>: Fixed interleaving of text and tool cards when streaming;
messages now appear in correct chronological order</li>
<li><strong>Tool passthrough in ProviderChain</strong>: Fixed tools not being passed to fallback
providers when using provider chains</li>
<li>Fork/branch icon in session sidebar now renders cleanly at 16px (replaced
complex git-branch SVG with simple trunk+branch path).</li>
<li>Deleting a forked session now navigates to the parent session instead of
an unrelated sibling.</li>
<li><strong>Streaming tool calls for non-Anthropic providers</strong>: <code>OpenAiProvider</code>,
<code>GitHubCopilotProvider</code>, <code>KimiCodeProvider</code>, <code>OpenAiCodexProvider</code>, and
<code>ProviderChain</code> now implement <code>stream_with_tools()</code> so tool schemas are
sent in the streaming API request and tool-call events are properly parsed.
Previously only <code>AnthropicProvider</code> supported streaming tool calls; all
other providers silently dropped the tools parameter, causing the LLM to
emit tool invocations as plain text instead of structured function calls.</li>
<li><strong>Streaming tool call arguments dropped when index ≠ 0</strong>: When a provider
(e.g. GitHub Copilot proxying Claude) emits a text content block at
streaming index 0 and a tool_use block at index 1, the runner’s argument
finalization used the streaming index as the vector position directly.
Since <code>tool_calls</code> has only 1 element at position 0, the condition
<code>1 &lt; 1</code> was false and arguments were silently dropped (empty <code>{}</code>).
Fixed by mapping streaming indices to vector positions via a HashMap.</li>
<li><strong>Skill tools wrote to wrong directory</strong>: <code>create_skill</code>, <code>update_skill</code>, and
<code>delete_skill</code> used <code>std::env::current_dir()</code> captured at gateway startup,
writing skills to <code>&lt;cwd&gt;/.moltis/skills/</code> instead of <code>~/.moltis/skills/</code>.
Skills now write to <code>&lt;data_dir&gt;/skills/</code> (Personal source), which is always
discovered regardless of where the gateway was started.</li>
<li><strong>Skills page missing personal/project skills</strong>: The <code>/api/skills</code> endpoint
only returned manifest-based registry skills. Personal and project-local
skills were never shown in the navigation or skills page. The endpoint now
discovers and includes them alongside registry skills.</li>
</ul>
<h3 id="documentation-3"><a class="header" href="#documentation-3">Documentation</a></h3>
<ul>
<li>Added voice.md with TTS/STT provider documentation and setup guides</li>
<li>Added mobile-pwa.md with PWA installation and push notification documentation</li>
<li>Updated CLAUDE.md with cargo feature policy (features enabled by default)</li>
<li>Updated browser-automation.md with browser detection, screenshot display, and
model error handling sections</li>
<li>Rewrote session-branching.md with accurate fork details, UI methods, RPC
API, inheritance table, and deletion behavior.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="tool-registry.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="tool-registry.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
