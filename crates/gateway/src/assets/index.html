<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="color-scheme" content="dark light">

<!-- PWA Meta Tags -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0f1115" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#fafafa" media="(prefers-color-scheme: light)">
<meta name="mobile-web-app-capable" content="yes">

<!-- iOS PWA Meta Tags -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="moltis">
<link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">
<script>!function(){var t=localStorage.getItem("moltis-theme")||"system";if(t==="system")t=matchMedia("(prefers-color-scheme:dark)").matches?"dark":"light";document.documentElement.setAttribute("data-theme",t);document.documentElement.style.background=t==="dark"?"#0f1115":"#fafafa";document.documentElement.style.color=t==="dark"?"#e0e0e0":"#222"}()</script>
<title>moltis</title>
<link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/icon-96.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/icon-72.png">
<meta name="build-ts" content="__BUILD_TS__">
<script type="importmap">
{
  "imports": {
    "preact": "/assets/js/vendor/preact.mjs",
    "preact/hooks": "/assets/js/vendor/preact-hooks.mjs",
    "@preact/signals": "/assets/js/vendor/preact-signals.mjs",
    "htm/preact": "/assets/js/vendor/htm-preact.mjs",
    "luxon": "/assets/js/vendor/luxon.mjs",
    "uplot": "/assets/js/vendor/uplot.mjs",
    "pretty-bytes": "/assets/js/vendor/pretty-bytes.mjs"
  }
}
</script>
<link rel="stylesheet" href="/assets/css/base.css">
<link rel="stylesheet" href="/assets/css/layout.css">
<link rel="stylesheet" href="/assets/css/chat.css">
<link rel="stylesheet" href="/assets/css/components.css">
<link rel="stylesheet" href="/assets/css/mobile.css">
<link rel="stylesheet" href="/assets/css/uplot.css">
<link rel="stylesheet" href="/assets/style.css">
<link rel="modulepreload" href="/assets/js/app.js">
<link rel="modulepreload" href="/assets/js/pwa.js">
<link rel="modulepreload" href="/assets/js/pwa-install.js">
<link rel="modulepreload" href="/assets/js/mobile.js">
<link rel="modulepreload" href="/assets/js/state.js">
<link rel="modulepreload" href="/assets/js/theme.js">
<link rel="modulepreload" href="/assets/js/helpers.js">
<link rel="modulepreload" href="/assets/js/events.js">
<link rel="modulepreload" href="/assets/js/router.js">
<link rel="modulepreload" href="/assets/js/websocket.js">
<link rel="modulepreload" href="/assets/js/sessions.js">
<link rel="modulepreload" href="/assets/js/session-search.js">
<link rel="modulepreload" href="/assets/js/models.js">
<link rel="modulepreload" href="/assets/js/projects.js">
<link rel="modulepreload" href="/assets/js/project-combo.js">
<link rel="modulepreload" href="/assets/js/providers.js">
<link rel="modulepreload" href="/assets/js/chat-ui.js">
<link rel="modulepreload" href="/assets/js/icons.js">
<link rel="modulepreload" href="/assets/js/sandbox.js">
<link rel="modulepreload" href="/assets/js/nav-counts.js">
<link rel="modulepreload" href="/assets/js/logs-alert.js">
<link rel="modulepreload" href="/assets/js/page-chat.js">
<link rel="modulepreload" href="/assets/js/page-crons.js">
<link rel="modulepreload" href="/assets/js/page-projects.js">
<link rel="modulepreload" href="/assets/js/page-providers.js">
<link rel="modulepreload" href="/assets/js/page-channels.js">
<link rel="modulepreload" href="/assets/js/page-logs.js">
<link rel="modulepreload" href="/assets/js/page-skills.js">
<link rel="modulepreload" href="/assets/js/page-mcp.js">
<link rel="modulepreload" href="/assets/js/page-hooks.js">
<link rel="modulepreload" href="/assets/js/page-settings.js">
<link rel="modulepreload" href="/assets/js/page-images.js">
<link rel="modulepreload" href="/assets/js/emoji-picker.js">
<link rel="modulepreload" href="/assets/js/vendor/preact.mjs">
<link rel="modulepreload" href="/assets/js/vendor/preact-hooks.mjs">
<link rel="modulepreload" href="/assets/js/vendor/preact-signals.mjs">
<link rel="modulepreload" href="/assets/js/vendor/htm-preact.mjs">
<link rel="modulepreload" href="/assets/js/vendor/luxon.mjs">
<link rel="modulepreload" href="/assets/js/time-format.js">
</head>
<body>

<!-- Git branch banner (shown when running on a non-main branch) -->
<div id="branchBanner" class="branch-banner" style="display:none">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="14" height="14"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"/></svg>
  <span>Running on: <strong id="branchName"></strong></span>
</div>

<!-- Top bar -->
<header class="flex items-center gap-3 px-4 py-2.5 border-b border-[var(--border)] bg-[var(--surface)] shrink-0">
  <button id="burgerBtn" class="burger-btn" title="Navigation">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20"><path d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
  </button>
  <a href="/chats" id="titleLink" class="text-base font-medium tracking-wide text-[var(--text-strong)] no-underline cursor-pointer"><span id="titleEmoji"></span><span id="titleName">moltis</span></a>
  <script>!function(){var g=window.__MOLTIS__;if(!g||!g.identity)return;var i=g.identity;var e=document.getElementById("titleEmoji");var n=document.getElementById("titleName");if(e&&i.emoji)e.textContent=i.emoji+" ";if(n&&i.name)n.textContent=i.name}()</script>
  <span class="status-dot" id="statusDot"></span>
  <span class="text-xs text-[var(--muted)]" id="statusText">disconnected</span>
  <div class="flex-1"></div>

  <span id="memoryInfo" class="text-xs text-[var(--muted)]" title="Process memory · System free memory"></span>

  <!-- Theme toggle -->
  <div class="theme-toggle" id="themeToggle">
    <button class="theme-btn" data-theme-val="light" title="Light theme">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72 1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
    </button>
    <button class="theme-btn" data-theme-val="system" title="System theme">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8m-4-4v4"/></svg>
    </button>
    <button class="theme-btn" data-theme-val="dark" title="Dark theme">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75 9.75 9.75 0 0 1 8.25 6c0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25 9.75 9.75 0 0 0 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"/></svg>
    </button>
  </div>

</header>

<!-- Auth disabled warning banner (shown by JS when auth is removed) -->
<div id="authDisabledBanner" class="auth-disabled-banner" style="display:none">
  <span>Authentication is disabled. Anyone with network access can control moltis and your computer.</span>
  <a href="/settings/security" class="auth-disabled-setup">Set up authentication</a>
</div>

<!-- Update available banner (shown when a newer GitHub release exists) -->
<div id="updateBanner" class="info-banner" style="display:none">
  <span>
    An update is available
    <strong id="updateLatestVersion"></strong>
  </span>
  <a id="updateReleaseLink" href="https://github.com/moltis-org/moltis/releases/latest" target="_blank" rel="noopener noreferrer" class="auth-disabled-setup">View release</a>
  <button id="updateDismissBtn" type="button" class="auth-disabled-setup bg-transparent border-0 p-0 cursor-pointer">Dismiss</button>
</div>

<!-- PWA Install Banner (shown on mobile when not installed) -->
<div id="installBanner" class="hidden fixed bottom-0 left-0 right-0 z-50 bg-[var(--surface)] border-t border-[var(--border)] p-4 pb-[max(1rem,env(safe-area-inset-bottom))] shadow-lg flex-col gap-3 md:hidden">
  <div class="flex items-start gap-3">
    <img src="/assets/icons/icon-72.png" alt="moltis" class="w-12 h-12 rounded-lg shrink-0">
    <div data-instructions class="flex-1 min-w-0"></div>
  </div>
  <div class="flex gap-2 justify-end">
    <button data-install-btn class="provider-btn" style="display:none">Install</button>
    <button data-dismiss-btn class="provider-btn provider-btn-secondary">Not now</button>
  </div>
</div>

<!-- Overlays for mobile panels -->
<div id="navOverlay" class="nav-overlay"></div>
<div id="sessionsOverlay" class="sessions-overlay"></div>

<!-- Main layout -->
<div class="flex flex-1 min-h-0 overflow-hidden">
  <!-- Navigation panel -->
  <nav id="navPanel" class="nav-panel">
    <div class="flex-1 flex flex-col">
      <a href="/chats" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.3 48.3 0 0 0 5.862-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.4 48.4 0 0 0 12 3a48.4 48.4 0 0 0-5.775.514C4.623 3.746 3.5 5.14 3.5 6.74v6.009Z"/></svg>
        Chat
      </a>
      <a href="/channels" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 8.25h15m-16.5 7.5h15m-1.8-13.5-3.9 19.5m-2.1-19.5-3.9 19.5"/></svg>
        Channels
        <span class="nav-count ml-auto text-[0.85rem] leading-none px-1.5 py-0.5 rounded-full bg-[var(--surface2)] text-[var(--muted)]" id="navCountChannels"></span>
      </a>
      <a href="/crons" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/></svg>
        Crons
        <span class="nav-count ml-auto text-[0.85rem] leading-none px-1.5 py-0.5 rounded-full bg-[var(--surface2)] text-[var(--muted)]" id="navCountCrons"></span>
      </a>
      <a href="/sandboxes" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"/></svg>
        Sandboxes
        <span class="nav-count ml-auto text-[0.85rem] leading-none px-1.5 py-0.5 rounded-full bg-[var(--surface2)] text-[var(--muted)]" id="navCountImages"></span>
      </a>
      <a href="/logs" data-nav class="nav-link relative" id="navLogs">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/></svg>
        Logs
        <span id="logsAlertDot" class="hidden absolute top-1/2 right-2 -translate-y-1/2 w-[7px] h-[7px] rounded-full bg-[var(--warn)]"></span>
      </a>
      <a href="/mcp" data-nav class="nav-link" style="display:flex;align-items:center;gap:8px">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"/></svg>
        MCP Tools
        <span class="nav-count ml-auto text-[0.85rem] leading-none px-1.5 py-0.5 rounded-full bg-[var(--surface2)] text-[var(--muted)]" id="navCountMcp"></span>
      </a>
      <a href="/monitoring" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"/></svg>
        Monitoring
      </a>
      <a href="/projects" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"/></svg>
        Projects
        <span class="nav-count ml-auto text-[0.85rem] leading-none px-1.5 py-0.5 rounded-full bg-[var(--surface2)] text-[var(--muted)]" id="navCountProjects"></span>
      </a>
      <a href="/providers" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25H18.75M5.25 14.25C3.59315 14.25 2.25 12.9069 2.25 11.25M5.25 14.25C3.59315 14.25 2.25 15.5931 2.25 17.25C2.25 18.9069 3.59315 20.25 5.25 20.25H18.75C20.4069 20.25 21.75 18.9069 21.75 17.25C21.75 15.5931 20.4069 14.25 18.75 14.25M2.25 11.25C2.25 9.59315 3.59315 8.25 5.25 8.25H18.75C20.4069 8.25 21.75 9.59315 21.75 11.25M2.25 11.25C2.25 10.2763 2.5658 9.32893 3.15 8.55L5.7375 5.1C6.37488 4.25016 7.37519 3.75 8.4375 3.75H15.5625C16.6248 3.75 17.6251 4.25016 18.2625 5.1L20.85 8.55C21.4342 9.32893 21.75 10.2763 21.75 11.25M21.75 11.25C21.75 12.9069 20.4069 14.25 18.75 14.25M18.75 17.25H18.7575V17.2575H18.75V17.25ZM18.75 11.25H18.7575V11.2575H18.75V11.25ZM15.75 17.25H15.7575V17.2575H15.75V17.25ZM15.75 11.25H15.7575V11.2575H15.75V11.25Z"/></svg>
        Providers
        <span class="nav-count ml-auto text-[0.85rem] leading-none px-1.5 py-0.5 rounded-full bg-[var(--surface2)] text-[var(--muted)]" id="navCountProviders"></span>
      </a>
      <a href="/skills" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 0 0-2.455 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"/></svg>
        Skills
        <span class="nav-count ml-auto text-[0.85rem] leading-none px-1.5 py-0.5 rounded-full bg-[var(--surface2)] text-[var(--muted)]" id="navCountSkills"></span>
      </a>
      <a href="/hooks" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085"/></svg>
        Hooks
        <span class="nav-count ml-auto text-[0.85rem] leading-none px-1.5 py-0.5 rounded-full bg-[var(--surface2)] text-[var(--muted)]" id="navCountHooks"></span>
      </a>
    </div>
    <div class="border-t border-[var(--border)] border-b">
      <a href="/settings" data-nav class="nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.248a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/></svg>
        Settings
      </a>
    </div>
    <div class="py-2 text-center">
      <a href="https://github.com/moltis-org/moltis/issues/new" target="_blank" rel="noopener noreferrer" class="text-[0.7rem] text-[var(--muted)] no-underline hover:underline">Report an issue</a>
    </div>
  </nav>

  <!-- Sessions sidebar -->
  <div class="w-[240px] border-r border-[var(--border)] flex flex-col bg-[var(--surface)] shrink-0 hidden" id="sessionsPanel">
    <div class="px-3 py-2.5 border-b border-[var(--border)] flex items-center justify-between">
      <span class="text-sm text-[var(--muted)] font-medium">Sessions</span>
      <button id="newSessionBtn" class="text-xs text-[var(--muted)] border border-[var(--border)] px-2 py-0.5 rounded hover:text-[var(--text)] hover:border-[var(--border-strong)] transition-colors cursor-pointer bg-transparent">+ New</button>
    </div>
    <!-- Project selector -->
    <div class="px-3 py-2 border-b border-[var(--border)] flex items-center gap-2">
      <select id="projectSelect" class="flex-1 text-xs bg-[var(--surface2)] border border-[var(--border)] rounded px-2 py-1.5 text-[var(--text)] focus:outline-none focus:border-[var(--border-strong)] cursor-pointer font-sans">
        <option value="">No project</option>
      </select>
      <button id="manageProjectsBtn" class="text-xs text-[var(--muted)] border border-[var(--border)] px-2 py-0.5 rounded hover:text-[var(--text)] hover:border-[var(--border-strong)] transition-colors cursor-pointer bg-transparent" title="Manage projects">+</button>
    </div>
    <div class="px-3 py-2 border-b border-[var(--border)] relative">
      <input id="sessionSearch" type="text" placeholder="Search sessions…"
             class="w-full text-xs bg-[var(--surface2)] border border-[var(--border)] rounded px-2 py-1.5 text-[var(--text)] focus:outline-none focus:border-[var(--border-strong)] font-sans" />
      <div id="searchResults" class="hidden"></div>
    </div>
    <div class="flex-1 overflow-y-auto" id="sessionList"></div>
  </div>

  <!-- Page content (swapped by router) -->
  <div id="pageContent" class="flex-1 flex flex-col min-w-0 overflow-hidden"></div>
</div>

<!-- Mobile sessions toggle FAB -->
<button id="sessionsToggle" class="sessions-toggle-btn" title="Toggle sessions">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z" />
  </svg>
</button>

<!-- Modals (created on demand by modals.js) -->
<div id="modalRoot"></div>

<!-- Tailscale section hidden elements (toggled by page-settings.js) -->
<div id="ts-installed-bar" style="display:none">
  <div class="info-bar">
    <span class="info-field">
      <span class="status-dot connected"></span>
      <span class="info-label">Installed</span>
      <span data-info-version class="info-version"></span>
    </span>
    <span data-ts-tailnet-wrap class="info-field" style="display:none">
      <span class="info-label">Tailnet:</span>
      <span data-ts-tailnet class="info-value-strong"></span>
    </span>
    <span data-ts-account-wrap class="info-field" style="display:none">
      <span class="info-label">Account:</span>
      <span data-ts-account class="info-value"></span>
    </span>
    <span data-ts-ip-wrap class="info-field" style="display:none">
      <span class="info-label">IP:</span>
      <span data-ts-ip class="info-value-mono"></span>
    </span>
  </div>
</div>

<div id="ts-not-installed" style="display:none">
  <div class="info-bar" style="justify-content:center;flex-direction:column;gap:12px;text-align:center">
    <p style="font-size:.875rem;color:var(--text);margin:0">
      The <code style="font-family:var(--font-mono);font-size:.875rem">tailscale</code> CLI was not found on this machine.
    </p>
    <div>
      <a href="https://tailscale.com/download" target="_blank" rel="noopener"
        class="provider-btn" style="display:inline-block;text-decoration:none">
        Install Tailscale
      </a>
      <button data-ts-recheck class="provider-btn provider-btn-secondary" style="margin-left:8px">
        Re-check
      </button>
    </div>
  </div>
</div>

<div id="ts-error" class="settings-alert-error whitespace-pre-line max-w-form" style="display:none">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="18" height="18" class="shrink-0 mt-0.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/></svg>
  <span data-ts-error-text class="whitespace-pre-line"></span>
</div>

<div id="ts-not-running" class="alert-warning-text max-w-form" style="display:none">
  <span class="alert-label-warn">Warning:</span>
  Tailscale is not running. Start it with <code class="font-mono">tailscale up</code> or open the Tailscale app.
</div>

<div id="ts-mode-section" class="max-w-form" style="display:none">
  <h3 class="text-sm font-medium text-[var(--text-strong)] mb-2">Mode</h3>
  <div data-ts-mode-btns class="flex gap-2"></div>
  <div data-ts-configuring class="text-xs text-[var(--muted)] mt-1.5" style="display:none"></div>
</div>

<div id="ts-hostname" class="max-w-form" style="display:none">
  <h3 class="text-sm font-medium text-[var(--text-strong)] mb-1">Hostname</h3>
  <a data-ts-hostname-link href="#" target="_blank" rel="noopener" class="font-mono text-sm text-[var(--text)] no-underline pointer-events-none">
    <span data-ts-hostname-value></span>
  </a>
</div>

<div id="ts-url" class="max-w-form" style="display:none">
  <h3 class="text-sm font-medium text-[var(--text-strong)] mb-1">URL</h3>
  <div class="font-mono text-sm">
    <a data-ts-url-link href="#" target="_blank" rel="noopener" class="text-[var(--accent)] no-underline"></a>
  </div>
</div>

<div id="ts-funnel-warning" class="alert-warning-text max-w-form" style="display:none">
  <span class="alert-label-warn">Warning:</span>
  Funnel exposes your gateway to the public internet. Make sure password authentication is configured.
</div>

<div id="ts-funnel-security-warning" class="alert-warning-text max-w-form" style="display:none">
  <span class="alert-label-warn">Warning:</span>
  Enabling Funnel exposes moltis to the public internet. This code has not been security-audited. Use at your own risk.
</div>
<div id="ts-funnel-auth-btn" style="display:none">
  <a href="/settings/security" class="provider-btn">Set up authentication</a>
</div>

<!-- Voice provider setup instructions (toggled by page-settings.js) -->
<div id="voice-whisper-cli-instructions" class="text-xs text-[var(--muted)]" style="display:none;line-height:1.6;">
  <strong>Installation:</strong><br />
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded">brew install whisper-cpp</code>
  <br />
  <strong>Configuration:</strong><br />
  Add to your <code class="font-mono text-xs">moltis.toml</code>:
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded whitespace-pre-wrap">[voice.stt]
provider = "whisper-cli"

[voice.stt.whisper_cli]
model_path = "~/.moltis/models/ggml-base.en.bin"</code>
  Download models from <a href="https://huggingface.co/ggerganov/whisper.cpp/tree/main" target="_blank" rel="noopener" class="hover:underline text-[var(--accent)]">Hugging Face</a>.
</div>

<div id="voice-sherpa-onnx-instructions" class="text-xs text-[var(--muted)]" style="display:none;line-height:1.6;">
  See <a href="https://k2-fsa.github.io/sherpa/onnx/install.html" target="_blank" rel="noopener" class="hover:underline text-[var(--accent)]">sherpa-onnx documentation</a> for installation.<br /><br />
  <strong>Configuration:</strong><br />
  Add to your <code class="font-mono text-xs">moltis.toml</code>:
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded whitespace-pre-wrap">[voice.stt]
provider = "sherpa-onnx"

[voice.stt.sherpa_onnx]
model_dir = "~/.moltis/models/sherpa-onnx"</code>
</div>

<div id="voice-piper-instructions" class="text-xs text-[var(--muted)]" style="display:none;line-height:1.6;">
  <strong>Installation:</strong><br />
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded">pip install piper-tts</code>
  Or download from <a href="https://github.com/rhasspy/piper/releases" target="_blank" rel="noopener" class="hover:underline text-[var(--accent)]">GitHub releases</a>.<br /><br />
  <strong>Download a voice model:</strong><br />
  Browse voices at <a href="https://rhasspy.github.io/piper-samples/" target="_blank" rel="noopener" class="hover:underline text-[var(--accent)]">piper-samples</a> and download the .onnx file.<br /><br />
  <strong>Configuration:</strong><br />
  Add to your <code class="font-mono text-xs">moltis.toml</code>:
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded whitespace-pre-wrap">[voice.tts]
provider = "piper"

[voice.tts.piper]
model_path = "~/.moltis/models/en_US-lessac-medium.onnx"</code>
</div>

<div id="voice-coqui-instructions" class="text-xs text-[var(--muted)]" style="display:none;line-height:1.6;">
  <strong>Installation:</strong><br />
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded">pip install TTS</code>
  <br />
  <strong>Start the server:</strong><br />
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded">tts-server --model_name tts_models/en/ljspeech/tacotron2-DDC</code>
  Or use Docker:<br />
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded">docker run -p 5002:5002 ghcr.io/coqui-ai/tts</code>
  <br />
  <strong>Configuration:</strong><br />
  Add to your <code class="font-mono text-xs">moltis.toml</code>:
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded whitespace-pre-wrap">[voice.tts]
provider = "coqui"

[voice.tts.coqui]
endpoint = "http://localhost:5002"</code>
  <br />
  Browse available models: <a href="https://github.com/coqui-ai/TTS#available-models" target="_blank" rel="noopener" class="hover:underline text-[var(--accent)]">coqui-ai/TTS</a>
</div>

<div id="voice-voxtral-instructions" class="text-xs text-[var(--muted)]" style="display:none;line-height:1.6;">
  <div data-voxtral-requirements></div>
  <strong>Requirements:</strong> Linux, Python 3.10+, CUDA GPU with 10GB+ VRAM<br /><br />
  <strong>Setup:</strong><br />
  1. Install vLLM: <code class="font-mono text-xs">pip install "vllm[audio]"</code><br />
  2. Start the server:<br />
  <code class="font-mono text-xs block my-1 ml-3 p-1.5 bg-[var(--bg)] rounded whitespace-pre-wrap">vllm serve mistralai/Voxtral-Mini-3B-2507 \
  --tokenizer_mode mistral \
  --config_format mistral \
  --load_format mistral</code>
  3. The model downloads automatically on first run (~3GB)<br /><br />
  <strong>Configuration:</strong><br />
  Add to your <code class="font-mono text-xs">moltis.toml</code>:
  <code class="font-mono text-xs block my-1 p-1.5 bg-[var(--bg)] rounded whitespace-pre-wrap">[voice.stt]
provider = "voxtral-local"

[voice.stt.voxtral_local]
endpoint = "http://localhost:8000"</code>
  <br />
  <strong>Languages:</strong> English, French, German, Spanish, Portuguese, Italian, Dutch, Polish, Swedish, Norwegian, Danish, Finnish, Arabic
</div>

<div id="voice-voxtral-requirements-ok" class="text-xs p-2 rounded-md mb-3 border border-[var(--accent)]" style="display:none;background:color-mix(in srgb, var(--accent) 10%, transparent);">
  <div class="font-medium text-[var(--accent)]">✓ System requirements met</div>
  <div class="text-[var(--muted)] mt-1">
    <strong>Detected:</strong> <span data-voxtral-detected></span>
  </div>
</div>

<div id="voice-voxtral-requirements-fail" class="text-xs p-2 rounded-md mb-3 border border-[var(--warning,#f59e0b)]" style="display:none;background:color-mix(in srgb, var(--warning, #f59e0b) 10%, transparent);">
  <div class="font-medium" style="color:var(--warning,#f59e0b)">⚠ System requirements not met</div>
  <div class="text-[var(--muted)] mt-1">
    <strong>Detected:</strong> <span data-voxtral-detected></span>
  </div>
  <ul data-voxtral-reasons class="text-[var(--muted)] mt-1.5 pl-4 m-0"></ul>
</div>

<!-- Templates -->
<template id="tpl-thinking-dots">
  <span class="thinking-dots"><span></span><span></span><span></span></span>
</template>


<template id="tpl-exec-card">
  <div class="msg exec-card running">
    <div class="exec-prompt">
      <span class="exec-prompt-char">$</span>
      <span data-cmd></span>
    </div>
    <div class="exec-status">running…</div>
  </div>
</template>

<template id="tpl-approval-card">
  <div class="msg approval-card">
    <div class="approval-label">Command requires approval:</div>
    <code class="approval-cmd"></code>
    <div class="approval-btns">
      <button class="approval-btn approval-allow">Allow</button>
      <button class="approval-btn approval-deny">Deny</button>
    </div>
    <div class="approval-countdown"></div>
  </div>
</template>

<template id="tpl-session-item">
  <div class="session-item">
    <div class="session-info">
      <div class="session-label">
        <span class="session-icon"></span>
        <span data-label-text></span>
      </div>
      <div class="session-meta"></div>
    </div>
    <div class="session-actions"></div>
  </div>
</template>

<template id="tpl-install-hint">
  <div class="install-hint">
    <div data-install-label>Install with any of:</div>
    <div data-install-commands class="flex flex-col gap-1 mt-1"></div>
  </div>
</template>

<template id="tpl-install-cmd">
  <code data-cmd></code>
</template>

<template id="tpl-model-notice">
  <div class="ctx-card" style="max-width:400px">
    <div class="ctx-header">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--warning,#eab308)">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
        <line x1="12" y1="9" x2="12" y2="13"/>
        <line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
      <span class="ctx-header-title">Chat-only mode</span>
    </div>
    <div class="ctx-section">
      <div class="ctx-row">
        <span class="ctx-label">Model</span>
        <span class="ctx-value" data-model-name></span>
      </div>
      <div class="ctx-row">
        <span class="ctx-label">Provider</span>
        <span class="ctx-value" data-provider></span>
      </div>
      <div class="ctx-disabled" style="margin-top:8px">
        Tools disabled — file operations, shell commands, and memory search are not available.
      </div>
    </div>
  </div>
</template>

<template id="tpl-welcome-card">
  <div id="welcomeCard" class="my-auto self-center flex flex-col items-center text-center px-6 py-10 max-w-md">
    <div data-welcome-emoji class="text-4xl mb-4"></div>
    <h2 class="text-lg font-medium text-[var(--text)] mb-1">
      <span data-welcome-greeting></span>
    </h2>
    <p class="text-sm text-[var(--muted)] mb-6">
      I'm <span data-welcome-bot-name class="font-medium text-[var(--text)]"></span>. How can I help?
    </p>
    <ul class="text-left text-sm text-[var(--muted)] flex flex-col gap-3 w-full">
      <li class="flex items-start gap-3">
        <span class="text-[var(--accent)] mt-0.5 flex-shrink-0">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        </span>
        <span>Chat with multiple AI providers and models</span>
      </li>
      <li class="flex items-start gap-3">
        <span class="text-[var(--accent)] mt-0.5 flex-shrink-0">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
        </span>
        <span>Run commands in a sandboxed environment</span>
      </li>
      <li class="flex items-start gap-3">
        <span class="text-[var(--accent)] mt-0.5 flex-shrink-0">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </span>
        <span>Browse the web and fetch content</span>
      </li>
      <li class="flex items-start gap-3">
        <span class="text-[var(--accent)] mt-0.5 flex-shrink-0">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
        </span>
        <span>Remember context across sessions with long-term memory</span>
      </li>
      <li class="flex items-start gap-3">
        <span class="text-[var(--accent)] mt-0.5 flex-shrink-0">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
        </span>
        <span>Extend with MCP tools, skills, and plugins</span>
      </li>
    </ul>
    <div class="mt-6 text-xs text-[var(--muted)]">
      Type a message or use <kbd class="px-1.5 py-0.5 bg-[var(--surface2)] border border-[var(--border)] rounded text-[var(--text)] text-xs font-mono">/</kbd> for commands
    </div>
  </div>
</template>

<script type="module" src="/assets/js/app.js"></script>
</body>
</html>
